(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{555:()=>{},953:()=>{},1167:()=>{},1874:(e,t,a)=>{Promise.resolve().then(a.bind(a,3262))},2715:()=>{},3262:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>Y});var n=a(5155),r=a(2115);a(2715);var s=a(6766);a(7311);let o=e=>{let{label:t,icon:a,active:r,onClick:s}=e;return(0,n.jsxs)("div",{className:"navBarItem ".concat(r?"active":""),onClick:s,children:[(0,n.jsx)("i",{className:"".concat(a," icon")})," ",t]})},i=e=>{let{subModule:t,activeSubModule:a,onClick:r}=e;return(0,n.jsx)("div",{className:"subModuleItem ".concat(a===t?"active":""),onClick:()=>r(t),children:t})},l=e=>{let{activeModule:t,activeSubModule:a,setActiveModule:r,setActiveSubModule:l}=e,c=e=>{r(e),l("")},d=e=>{l(e)};return(0,n.jsxs)("div",{className:"navBar",children:[(0,n.jsx)("div",{className:"Logo",children:(0,n.jsx)("div",{className:"LogoImage",children:(0,n.jsx)(s.default,{src:"/agilaLogo.png",alt:"Logo",width:150,height:50,className:"logoImage"})})}),(0,n.jsxs)("div",{className:"navContainer",children:[(0,n.jsxs)("div",{className:"navBarItems",children:[(0,n.jsx)(o,{label:"Dashboard",icon:"ri-dashboard-line",active:"Dashboard"===t,onClick:()=>c("Dashboard")}),(0,n.jsx)(o,{label:"Revenue Management",icon:"fa-duotone fa-regular fa-dollar-sign",active:"Revenue Management"===t,onClick:()=>c("Revenue Management")}),(0,n.jsx)(o,{label:"Expense Management",icon:"ri-money-dollar-circle-line",active:"Expense Management"===t,onClick:()=>c("Expense Management")}),(0,n.jsx)(o,{label:"Receipt Management",icon:"ri-receipt-line",active:"Receipt Management"===t,onClick:()=>c("Receipt Management")}),"Receipt Management"===t&&(0,n.jsx)(i,{subModule:"Receipt Processing",activeSubModule:a,onClick:d}),"Receipt Management"===t&&(0,n.jsx)(i,{subModule:"Receipt Archive",activeSubModule:a,onClick:d}),(0,n.jsx)(o,{label:"Employee Financial Management",icon:"ri-group-line",active:"Employee Financial Management"===t,onClick:()=>c("Employee Financial Management")}),"Employee Financial Management"===t&&(0,n.jsx)(i,{subModule:"Balance & Payment",activeSubModule:a,onClick:d}),"Employee Financial Management"===t&&(0,n.jsx)(i,{subModule:"Payroll",activeSubModule:a,onClick:d}),(0,n.jsx)(o,{label:"Financial Requests",icon:"ri-service-bell-line",active:"Financial Requests"===t,onClick:()=>c("Financial Requests")}),(0,n.jsx)(o,{label:"Financial Reports",icon:"ri-file-chart-line",active:"Financial Reports"===t,onClick:()=>c("Financial Reports")}),(0,n.jsx)(o,{label:"Audit Logs",icon:"ri-booklet-line",active:"Audit Logs"===t,onClick:()=>c("Audit Logs")})]}),(0,n.jsxs)("div",{className:"logout",children:[(0,n.jsx)("i",{className:"ri-logout-box-line"})," Logout"]})]})]})};a(6145);let c=()=>{let[e,t]=(0,r.useState)(""),a=e=>{t(e)};return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("div",{className:"topBar",children:(0,n.jsxs)("div",{className:"topBarItems",children:[(0,n.jsx)("div",{className:"topBarItem ".concat("Accounting"===e?"active":""),onClick:()=>a("Accounting"),children:"Accounting"}),(0,n.jsx)("div",{className:"topBarItem ".concat("HumanResource"===e?"active":""),onClick:()=>a("HumanResource"),children:"Human Resource"}),(0,n.jsx)("div",{className:"topBarItem ".concat("Inventory"===e?"active":""),onClick:()=>a("Inventory"),children:"Inventory"}),(0,n.jsx)("div",{className:"topBarItem ".concat("Operation"===e?"active":""),onClick:()=>a("Operation"),children:"Operation"})]})})})};a(1167),a(953);let d=e=>{let{currentPage:t,totalPages:a,pageSize:s,onPageChange:o,onPageSizeChange:i}=e,[l,c]=(0,r.useState)(""),d=(()=>{let e=[],n=Math.max(1,t-Math.floor(1.5)),r=Math.min(a,n+3-1);for(let t=n;t<=r;t++)e.push(t);return e})();return(0,n.jsxs)("div",{className:"pagination-container",children:[(0,n.jsx)("div",{className:"pagination-dropdown-container",children:(0,n.jsx)("select",{value:s,id:"recordsPerPage",className:"pagination-dropdown",onChange:e=>i(Number(e.target.value)),children:[5,10,20,50].map(e=>(0,n.jsxs)("option",{value:e,children:[e," items per page"]},e))})}),(0,n.jsxs)("div",{className:"pagination-button-container",children:[(0,n.jsx)("button",{className:"pagination-button",onClick:()=>o(t-1),disabled:1===t,children:"Previous"}),(0,n.jsx)("button",{className:"pagination-button ".concat(1===t?"active":""),onClick:()=>o(1),children:"1"}),d[0]>2&&(0,n.jsx)("span",{className:"pagination-ellipsis",children:"..."}),d.map(e=>1!==e&&e!==a?(0,n.jsx)("button",{className:"pagination-button ".concat(t===e?"active":""),onClick:()=>o(e),children:e},e):null),a>d[d.length-1]+1&&(0,n.jsx)("span",{className:"pagination-ellipsis",children:"..."}),a>1&&(0,n.jsx)("button",{className:"pagination-button ".concat(t===a?"active":""),onClick:()=>o(a),children:a}),(0,n.jsx)("button",{className:"pagination-button",onClick:()=>o(t+1),disabled:t===a,children:"Next"})]}),(0,n.jsxs)("div",{className:"pagination-goto-container",children:[(0,n.jsxs)("label",{className:"pagination-go-to",children:["Go to:",(0,n.jsx)("input",{type:"number",value:l,onChange:e=>c(e.target.value),placeholder:"Page #",className:"pagination-input"})]}),(0,n.jsx)("button",{className:"pagination-go-button",onClick:()=>{let e=Number(l);e>=1&&e<=a&&o(e),c("")},children:" Go "})]})]})};var u=a(4752),m=a.n(u);a(9838);var h=a(3464);let p=()=>m().fire({icon:"warning",text:"Please fill out all fields.",confirmButtonColor:"#961C1E",background:"white",backdrop:!1,customClass:{popup:"swal-custom-popup"}}),g=()=>m().fire({icon:"error",title:"Invalid Amount",text:"Amount must be a positive number.",confirmButtonColor:"#961C1E",background:"white",backdrop:!1,customClass:{popup:"swal-custom-popup"}}),x=()=>m().fire({title:"Confirmation",html:"<p>Are you sure you want to <b>ADD</b> this record?</p>",showCancelButton:!0,confirmButtonText:"Confirm",cancelButtonText:"Cancel",background:"white",confirmButtonColor:"#13CE66",cancelButtonColor:"#961C1E",backdrop:!1,customClass:{popup:"swal-custom-popup"}}),j=()=>m().fire({icon:"success",title:"Added!",text:"Your revenue record has been added.",confirmButtonColor:"#961C1E",background:"white",backdrop:!1,customClass:{popup:"swal-custom-popup"}}),v=e=>new Date(e).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"}),_=e=>{let{onClose:t,onAddRevenue:a,assignments:s,currentUser:o}=e,[i,l]=(0,r.useState)(""),[c,d]=(0,r.useState)(""),[u,_]=(0,r.useState)(s.filter(e=>!e.is_revenue_recorded)),[f,y]=(0,r.useState)({category:"Boundary",assignment_id:"",total_amount:0,collection_date:new Date().toISOString().split("T")[0],created_by:o,other_source:""});(0,r.useEffect)(()=>{let e=()=>{let e=new Date;l(e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})),d(v(e))};e();let t=setInterval(e,6e4);return()=>clearInterval(t)},[]),(0,r.useEffect)(()=>{"Other"===f.category?(_([]),y(e=>({...e,assignment_id:"",total_amount:0}))):_(s.filter(e=>!e.is_revenue_recorded&&("Boundary"===f.category?"Boundary"===e.assignment_type:"Percentage"===f.category?"Percentage"===e.assignment_type:"Bus_Rental"===f.category&&"Bus_Rental"===e.assignment_type)).sort((e,t)=>new Date(e.date_assigned).getTime()-new Date(t.date_assigned).getTime()))},[f.category,s]),(0,r.useEffect)(()=>{if(f.assignment_id&&"Other"!==f.category){let e=s.find(e=>e.assignment_id===f.assignment_id);e&&y(t=>({...t,total_amount:e.trip_revenue}))}},[f.assignment_id,s,f.category]);let b=e=>{let{name:t,value:a}=e.target;"category"===t?y(e=>({...e,[t]:a,assignment_id:"",total_amount:0})):"total_amount"===t&&"Other"===f.category?y(e=>({...e,[t]:parseFloat(a)||0})):y(e=>({...e,[t]:a}))},N=async e=>{e.preventDefault();let{category:n,assignment_id:r,total_amount:s,collection_date:i,other_source:l}=f;if(!n||!i||!o||"Other"!==n&&!r||"Other"===n&&!l)return void await p();if(!function(e){return!isNaN(e)&&e>0}(s))return void await g();if((await x()).isConfirmed)try{await a({category:n,total_amount:s,collection_date:i,created_by:o,..."Other"!==n?{assignment_id:r}:{other_source:l}}),r&&await h.A.put("/api/assignments/".concat(r),{is_revenue_recorded:!0}),await j(),t()}catch(t){console.error("Error adding revenue:",t);let e=t instanceof Error?t.message:"An unknown error occurred";m().fire("Error","Failed to add revenue: "+e,"error")}},C=e=>{let t="Airconditioned"===e.bus_type?"A":"O";return"â‚± ".concat(e.trip_revenue," | ").concat(t," | ").concat(e.bus_bodynumber," - ").concat(e.bus_route," | ").concat(e.driver_name.split(" ").pop()," & ").concat(e.conductor_name.split(" ").pop()," | ").concat(v(e.date_assigned))};return(0,n.jsx)("div",{className:"modalOverlay",children:(0,n.jsxs)("div",{className:"addRevenueModal",children:[(0,n.jsxs)("div",{className:"modalHeader",children:[(0,n.jsx)("h2",{children:"Add Revenue"}),(0,n.jsxs)("div",{className:"timeDate",children:[(0,n.jsx)("div",{className:"currTime",children:i}),(0,n.jsx)("div",{className:"currDate",children:c})]})]}),(0,n.jsxs)("form",{onSubmit:N,children:[(0,n.jsxs)("div",{className:"formFieldsHorizontal",children:[(0,n.jsxs)("div",{className:"formLabels",children:[(0,n.jsx)("div",{className:"formLabel",children:"Category"}),(0,n.jsx)("div",{className:"formLabel",children:"Source"}),(0,n.jsx)("div",{className:"formLabel",children:"Amount"}),(0,n.jsx)("div",{className:"formLabel",children:"Collection Date"})]}),(0,n.jsxs)("div",{className:"formInputs",children:[(0,n.jsx)("div",{className:"formField",children:(0,n.jsxs)("select",{id:"category",name:"category",value:f.category,onChange:b,required:!0,className:"formSelect",children:[(0,n.jsx)("option",{value:"Boundary",children:"Boundary"}),(0,n.jsx)("option",{value:"Percentage",children:"Percentage"}),(0,n.jsx)("option",{value:"Bus_Rental",children:"Bus Rental"}),(0,n.jsx)("option",{value:"Other",children:"Other"})]})}),(0,n.jsxs)("div",{className:"formField",children:["Other"===f.category?(0,n.jsx)("input",{type:"text",id:"other_source",name:"other_source",value:f.other_source,onChange:b,placeholder:"Please specify",required:!0,className:"formInput"}):(0,n.jsxs)("select",{id:"assignment_id",name:"assignment_id",value:f.assignment_id,onChange:b,required:!0,className:"formSelect",disabled:0===u.length,children:[(0,n.jsxs)("option",{value:"",children:["Select ",f.category," Assignment"]}),u.map(e=>(0,n.jsx)("option",{value:e.assignment_id,children:C(e)},e.assignment_id))]}),"Other"!==f.category&&0===u.length&&(0,n.jsxs)("div",{className:"noAssignments",children:["No ",f.category," assignments available"]})]}),(0,n.jsx)("div",{className:"formField",children:"Other"===f.category?(0,n.jsx)("input",{type:"number",id:"total_amount",name:"total_amount",value:f.total_amount||"",onChange:b,placeholder:"Enter amount",required:!0,className:"formInput",min:"0",step:"0.01"}):(0,n.jsx)("input",{type:"text",id:"total_amount",name:"total_amount",value:f.total_amount.toLocaleString(),readOnly:!0,className:"formInput"})}),(0,n.jsx)("div",{className:"formField",children:(0,n.jsx)("input",{type:"date",id:"date",name:"date",value:f.collection_date,onChange:b,required:!0,className:"formInput"})})]})]}),(0,n.jsxs)("div",{className:"modalButtons",children:[(0,n.jsx)("button",{type:"button",className:"cancelButton",onClick:t,children:"Cancel"}),(0,n.jsx)("button",{type:"submit",className:"addButton",children:"Add"})]})]})]})})};a(555);let f=(0,a(851).UU)("https://dyvxlzuhnamrnqppehnv.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR5dnhsenVobmFtcm5xcHBlaG52Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgyNDM4ODUsImV4cCI6MjA2MzgxOTg4NX0.CKQLXvc4UUf55PHOj8FQuH-JeqVVpv1i4cwjKTVYxeE"),y="http://localhost:3000";async function b(){try{let e=await fetch("".concat(y,"/api/assignments/cache"));if(!e.ok)return null;let{data:t}=await e.json();if(!t)return null;return t.map(e=>({assignment_id:e.assignment_id,bus_bodynumber:e.bus_bodynumber,bus_platenumber:e.bus_platenumber,bus_route:e.bus_route,bus_type:e.bus_type,driver_name:e.driver_name,conductor_name:e.conductor_name,date_assigned:new Date(e.date_assigned).toISOString(),trip_fuel_expense:Number(e.trip_fuel_expense),trip_revenue:Number(e.trip_revenue),is_revenue_recorded:e.is_revenue_recorded,is_expense_recorded:e.is_expense_recorded,assignment_type:e.assignment_type}))}catch(e){return console.error("Error fetching from cache:",e),null}}async function N(){try{if(!(await fetch("".concat(y,"/api/assignments/cache"),{method:"POST"})).ok)throw Error("Failed to update cache")}catch(e){throw console.error("Error updating cache:",e),e}}async function C(e){try{let t=await b();if(t){let a=t.find(t=>t.assignment_id===e);if(a)return a}let{data:a,error:n}=await f.from("op_bus_assignments").select("*").eq("assignment_id",e).single();if(n)return console.error("Failed to fetch assignment from Supabase:",n),null;return await N(),a?{...a,trip_fuel_expense:Number(a.trip_fuel_expense),trip_revenue:Number(a.trip_revenue)}:null}catch(e){return console.error("Error in getAssignmentById:",e),null}}async function w(){try{let e=await b();if(e)return e.filter(e=>!e.is_revenue_recorded);let{data:t,error:a}=await f.from("op_bus_assignments").select("*").eq("is_revenue_recorded",!1);if(a)throw Error(a.message);return await N(),t.map(e=>({...e,trip_fuel_expense:Number(e.trip_fuel_expense),trip_revenue:Number(e.trip_revenue),is_revenue_recorded:!1}))}catch(e){throw console.error("Error fetching unrecorded revenue assignments:",e),e}}async function S(){try{let e=await b();if(e)return e.filter(e=>!e.is_expense_recorded);let{data:t,error:a}=await f.from("op_bus_assignments").select("*").eq("is_expense_recorded",!1);if(a)throw Error(a.message);return await N(),t.map(e=>({...e,trip_fuel_expense:Number(e.trip_fuel_expense),trip_revenue:Number(e.trip_revenue),is_expense_recorded:!1}))}catch(e){throw console.error("Error fetching unrecorded expense assignments:",e),e}}async function E(){try{let e=await b();if(e)return e;let{data:t,error:a}=await f.from("op_bus_assignments").select("*");if(a)throw Error(a.message);return await N(),t.map(e=>({...e,trip_fuel_expense:Number(e.trip_fuel_expense),trip_revenue:Number(e.trip_revenue),is_expense_recorded:!!e.is_expense_recorded}))}catch(e){throw console.error("Error fetching assignments:",e),e}}let D=e=>{let{record:t,onClose:a,onSave:s}=e,[o,i]=(0,r.useState)(t.collection_date),[l,c]=(0,r.useState)(t.amount),[d,u]=(0,r.useState)(t.other_source||""),[h,p]=(0,r.useState)(null),[g,x]=(0,r.useState)(0),[j,_]=(0,r.useState)(!1);(0,r.useEffect)(()=>{(async()=>{if(t.assignment_id)try{let e=await C(t.assignment_id);if(null==e?void 0:e.trip_revenue){p(e.trip_revenue);let a=Math.abs((t.amount-e.trip_revenue)/e.trip_revenue*100);x(a),_(a>10)}}catch(e){console.error("Error fetching assignment data:",e)}})()},[t.assignment_id,t.amount]);let f=e=>{if(c(e),h){let t=Math.abs((e-h)/h*100);x(t),_(t>10)}},y=async()=>{let e="Do you want to save the changes to this record?";j&&(e="Warning: The amount deviates by ".concat(g.toFixed(2),"% from the original trip revenue. Do you want to proceed?")),(await m().fire({title:"Save Changes?",text:e,icon:j?"warning":"question",showCancelButton:!0,confirmButtonColor:"#13CE66",cancelButtonColor:"#961C1E",confirmButtonText:"Yes, save it!",cancelButtonText:"Cancel",background:"white"})).isConfirmed&&s({revenue_id:t.revenue_id,collection_date:o,total_amount:l,other_source:"Other"===t.category?d:void 0})};return(0,n.jsx)("div",{className:"modalOverlay",children:(0,n.jsxs)("div",{className:"modalContent",children:[(0,n.jsxs)("div",{className:"modalHeader",children:[(0,n.jsx)("h2",{children:"Edit Revenue"}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Category:"})," ",t.category]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Collection Date:"})," ",v(t.collection_date)]})]}),(0,n.jsxs)("div",{className:"formGroup",children:[(0,n.jsx)("label",{children:"Collection Date"}),(0,n.jsx)("input",{type:"date",value:o,onChange:e=>i(e.target.value)})]}),"Other"===t.category&&(0,n.jsxs)("div",{className:"formGroup",children:[(0,n.jsx)("label",{children:"Source"}),(0,n.jsx)("input",{type:"text",value:d,onChange:e=>u(e.target.value),placeholder:"Specify source"})]}),(0,n.jsxs)("div",{className:"formGroup",children:[(0,n.jsx)("label",{children:"Amount"}),(0,n.jsxs)("div",{className:"amountInputGroup",children:[(0,n.jsx)("input",{type:"number",value:l,onChange:e=>f(parseFloat(e.target.value)),min:"0",step:"0.01"}),null!==h&&(0,n.jsxs)("div",{className:"tripRevenueReference",children:["Original Trip Revenue: â‚±",h.toLocaleString(),j&&(0,n.jsxs)("div",{className:"deviationWarning",children:["Deviation: ",g.toFixed(2),"%"]})]})]})]}),(0,n.jsxs)("div",{className:"modalButtons",children:[(0,n.jsx)("button",{onClick:a,className:"cancelBtn",children:"Cancel"}),(0,n.jsx)("button",{onClick:y,className:"saveBtn",children:"Save"})]})]})})},R=()=>{let[e,t]=(0,r.useState)([]),[a,s]=(0,r.useState)(!0),[o,i]=(0,r.useState)(""),[l,c]=(0,r.useState)(""),[u,h]=(0,r.useState)(""),[p,g]=(0,r.useState)(""),[x,j]=(0,r.useState)(1),[f,y]=(0,r.useState)(5),[b,N]=(0,r.useState)(!1),[C,S]=(0,r.useState)(!1),[R,O]=(0,r.useState)(null),[T,k]=(0,r.useState)([]),[B,A]=(0,r.useState)(!0),[I,F]=(0,r.useState)([]),P=e=>{let t="Airconditioned"===e.bus_type?"A":"O";return"".concat(t," | ").concat(e.bus_bodynumber," - ").concat(e.bus_route," | ").concat(e.driver_name.split(" ").pop()," & ").concat(e.conductor_name.split(" ").pop()," | ").concat(v(e.date_assigned))},L=async()=>{try{A(!0);let e=await w();k(e);let t=await E();F(t)}catch(e){console.error("Error fetching assignments:",e instanceof Error?e.message:"An unknown error occurred")}finally{A(!1)}};(0,r.useEffect)(()=>{L();let e=setInterval(()=>{L().catch(e=>{console.error("Background refresh failed:",e)})},3e5);return()=>clearInterval(e)},[]),(0,r.useEffect)(()=>{(async()=>{s(!0),A(!0);try{let e=await fetch("".concat("http://localhost:3000","/api/assignments/cache"));if(!e.ok)throw Error("Failed to fetch assignments");let{data:a}=await e.json(),n=a.filter(e=>!e.is_revenue_recorded);k(n),F(a);let r=await fetch("/api/revenues");if(!r.ok)throw Error("Failed to fetch revenues");let s=(await r.json()).map(e=>({revenue_id:e.revenue_id,category:e.category,total_amount:Number(e.total_amount),collection_date:new Date(e.collection_date).toISOString().split("T")[0],created_by:e.created_by,assignment_id:e.assignment_id,other_source:e.other_source||void 0}));t(s)}catch(e){console.error("Error fetching data:",e),m().fire("Error","Failed to load data","error")}finally{s(!1),A(!1)}})();let e=setInterval(()=>{fetch("".concat("http://localhost:3000","/api/assignments/cache")).then(e=>e.json()).then(e=>{let{data:t}=e;t&&k(t)}).catch(e=>console.error("Background refresh failed:",e))},3e4);return()=>clearInterval(e)},[]);let M=e.filter(e=>{var t,a;let n=((null==(t=e.category)?void 0:t.toLowerCase())||"").includes(o.toLowerCase())||"Other"===e.category&&((null==(a=e.other_source)?void 0:a.toLowerCase())||"").includes(o.toLowerCase()),r=!l||e.category===l,s=(!u||e.collection_date>=u)&&(!p||e.collection_date<=p);return n&&r&&s}),q=x*f,U=M.slice(q-f,q),V=Math.ceil(M.length/f),J=async a=>{try{if("Other"!==a.category&&e.find(e=>{let t=T.find(e=>e.assignment_id===a.assignment_id),n=e.assignment_id?T.find(t=>t.assignment_id===e.assignment_id):null;return!!t&&!!n&&new Date(t.date_assigned).toISOString().split("T")[0]===a.collection_date&&t.bus_bodynumber===n.bus_bodynumber&&e.category===a.category&&t.driver_name===n.driver_name&&t.conductor_name===n.conductor_name}))return void m().fire("Error","Duplicate revenue record found for the same assignment.","error");let n=await fetch("/api/revenues",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({category:a.category,total_amount:a.total_amount,collection_date:new Date(a.collection_date).toISOString(),created_by:a.created_by,assignment_id:a.assignment_id||null,other_source:"Other"===a.category?a.other_source:null})});if(!n.ok)throw Error("Create failed");let r=await n.json();t(e=>[{revenue_id:r.revenue_id,category:r.category,total_amount:Number(r.total_amount),collection_date:new Date(r.collection_date).toISOString().split("T")[0],created_by:r.created_by,assignment_id:r.assignment_id,other_source:r.other_source||void 0},...e]),a.assignment_id&&(await fetch("/api/assignments/".concat(a.assignment_id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({is_revenue_recorded:!0})})).ok&&k(e=>e.map(e=>e.assignment_id===a.assignment_id?{...e,is_revenue_recorded:!0}:e)),m().fire("Success","Revenue added successfully","success"),N(!1)}catch(e){console.error("Create error:",e),m().fire("Error","Failed to add revenue: "+(e instanceof Error?e.message:"Unknown error"),"error")}},G=async e=>{if((await m().fire({title:"Are you sure?",text:"This will delete the record permanently.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#13CE66",cancelButtonColor:"#961C1E",confirmButtonText:"Yes, delete it!",background:"white"})).isConfirmed)try{if(!(await fetch("/api/revenues/".concat(e),{method:"DELETE"})).ok)throw Error("Delete failed");t(t=>t.filter(t=>t.revenue_id!==e)),m().fire("Deleted!","Record deleted successfully","success")}catch(e){console.error("Delete error:",e),m().fire("Error","Failed to delete record","error")}},z=async e=>{try{let a=await fetch("/api/revenues/".concat(e.revenue_id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!a.ok)throw Error("Update failed");let n=await a.json();t(t=>{let a=t.filter(t=>t.revenue_id!==e.revenue_id);return[{revenue_id:n.revenue_id,category:n.category,total_amount:Number(n.total_amount),collection_date:new Date(n.collection_date).toISOString().split("T")[0],created_by:n.created_by,assignment_id:n.assignment_id,other_source:n.other_source||void 0},...a]}),S(!1),O(null),m().fire("Success","Record updated successfully","success")}catch(e){console.error("Update error:",e),m().fire("Error","Failed to update record","error")}},H=()=>{let e=new Date,t=e.toISOString().replace(/[:.]/g,"-").split("T")[1].slice(0,8),a=e.toISOString().split("T")[0],n="revenue_records";if(l&&(n+="_".concat(l.toLowerCase().replace("_","-"))),u||p){let e=u?new Date(u).toISOString().split("T")[0]:"all",t=p?new Date(p).toISOString().split("T")[0]:"present";n+="_".concat(e,"_to_").concat(t)}return n+="_".concat(a,"_").concat(t),"".concat(n,".csv")},Y=()=>{let e=["Collection Date","Category","Amount","Source Type"];return l?"Other"===l?[...e,"Other Source Description"]:[...e,"Bus Type","Body Number","Route","Driver Name","Conductor Name","Assignment Date"]:[...e,"Bus Type","Body Number","Route","Driver Name","Conductor Name","Assignment Date","Other Source Description"]},X=()=>{let e="Export Details:\n";if(e+="Category: ".concat(l||"All Categories","\n"),u||p){let t=u?v(u):"Beginning",a=p?v(p):"Present";e+="Date Range: ".concat(t," to ").concat(a,"\n")}else e+="Date Range: All Dates\n";return e+="Total Records: ".concat(M.length,"\n"),e+="Export Time: ".concat(new Date().toISOString(),"\n"),e+="Exported Columns: ".concat(Y().join(", "))},W=async()=>{try{let e=await fetch("/api/generate-export-id");if(!e.ok)throw Error("Failed to generate export ID");let{exportId:t}=await e.json(),a=X();if(!(await fetch("/api/auditlogs/export",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"EXPORT",table_affected:"RevenueRecord",record_id:t,performed_by:"user1",details:a})})).ok)throw Error("Failed to create audit log");return t}catch(e){throw console.error("Failed to create audit log:",e),e}},K=(e,t)=>{let a=Y(),n=a.join(",")+"\n",r=e.map(e=>{let t=e.assignment_id?I.find(t=>t.assignment_id===e.assignment_id):null,n=e=>e?e.includes(",")||e.includes('"')||e.includes("\n")?'"'.concat(e.replace(/"/g,'""'),'"'):e:"",r=[];return a.forEach(a=>{switch(a){case"Collection Date":r.push(n(v(e.collection_date)));break;case"Category":r.push(n(e.category));break;case"Amount":r.push(e.total_amount.toFixed(2));break;case"Source Type":r.push(t?"Assignment":"Other");break;case"Bus Type":r.push(n(null==t?void 0:t.bus_type));break;case"Body Number":r.push(n(null==t?void 0:t.bus_bodynumber));break;case"Route":r.push(n(null==t?void 0:t.bus_route));break;case"Driver Name":r.push(n(null==t?void 0:t.driver_name));break;case"Conductor Name":r.push(n(null==t?void 0:t.conductor_name));break;case"Assignment Date":r.push(n((null==t?void 0:t.date_assigned)?v(t.date_assigned):""));break;case"Other Source Description":r.push(n(e.other_source));break;default:r.push("")}}),r.join(",")}).join("\n"),s=new Blob([(()=>{let a='"# Revenue Records Export","","","","","","","","","",""\n';if(a+='"# Export ID:","'.concat(t,'","","","","","","","","",""\n'),a+='"# Generated:","'.concat(v(new Date),'","","","","","","","","",""\n'),l?a+='"# Category:","'.concat(l,'","","","","","","","","",""\n'):a+='"# Category:","All Categories","","","","","","","","",""\n',u||p){let e=u?v(u):"Beginning",t=p?v(p):"Present";a+='"# Date Range:","'.concat(e," to ").concat(t,'","","","","","","","","",""\n')}else a+='"# Date Range:","All Dates","","","","","","","","",""\n';return a+'"# Total Records:","'.concat(e.length,'","","","","","","","","",""\n\n')})()+n+r],{type:"text/csv;charset=utf-8;"}),o=URL.createObjectURL(s),i=document.createElement("a");i.href=o,i.download=H(),document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(o)};return(0,n.jsxs)("div",{className:"revenuePage",children:[(a||B)&&(0,n.jsx)("div",{className:"loading",children:"Loading..."}),(0,n.jsxs)("div",{className:"importExport",children:[(0,n.jsx)("button",{onClick:()=>{m().fire({title:"Confirm Export",html:(()=>{let e="<strong>Revenue Records Export</strong><br/><br/>";if(l?e+="<strong>Category:</strong> ".concat(l,"<br/>"):e+="<strong>Category:</strong> All Categories<br/>",u||p){let t=u?v(u):"Beginning",a=p?v(p):"Present";e+="<strong>Date Range:</strong> ".concat(t," to ").concat(a,"<br/>")}else e+="<strong>Date Range:</strong> All Dates<br/>";return e+"<strong>Total Records:</strong> ".concat(M.length)})(),icon:"question",showCancelButton:!0,confirmButtonText:"Export CSV",cancelButtonText:"Cancel",customClass:{popup:"export-confirmation-dialog"}}).then(async e=>{if(e.isConfirmed){if(0===M.length)return void m().fire({title:"No Records Found",text:"There are no records to export based on current filters. Do you want to proceed anyway?",icon:"warning",showCancelButton:!0,confirmButtonText:"Export Empty File",cancelButtonText:"Cancel"}).then(async e=>{if(e.isConfirmed)try{let e=await W();await K(M,e)}catch(e){console.error("Export failed:",e),m().fire("Error","Failed to complete export","error")}});try{let e=await W();await K(M,e)}catch(e){console.error("Export failed:",e),m().fire("Error","Failed to complete export","error")}}})},children:"Export CSV"}),(0,n.jsxs)("label",{className:"importLabel",children:["Import CSV",(0,n.jsx)("input",{type:"file",accept:".csv",onChange:e=>{var a;let n=null==(a=e.target.files)?void 0:a[0];if(!n)return;let r=new FileReader;r.onload=async e=>{var a;let n=(null==(a=e.target)?void 0:a.result).split("\n").slice(1);try{let e=n.filter(e=>e.trim()).map(async e=>{let[,t,a,n]=e.split(","),r=await fetch("/api/revenues",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({category:a,total_amount:parseFloat(n),collection_date:new Date(t).toISOString(),created_by:"import-job"})});return await r.json()}),a=await Promise.all(e);t(e=>[...e,...a.map(e=>({revenue_id:e.revenue_id,category:e.category,total_amount:Number(e.total_amount),collection_date:new Date(e.collection_date).toISOString().split("T")[0],created_by:e.created_by,assignment_id:e.assignment_id}))]),m().fire("Success","Import completed","success")}catch(e){console.error("Import error:",e),m().fire("Error","Failed to import some records","error")}},r.readAsText(n)},hidden:!0})]})]}),(0,n.jsxs)("div",{className:"settings",children:[(0,n.jsx)("input",{type:"text",placeholder:"Search by category...",value:o,onChange:e=>i(e.target.value)}),(0,n.jsxs)("div",{className:"filters",children:[(0,n.jsx)("input",{type:"date",value:u,onChange:e=>h(e.target.value)}),(0,n.jsx)("input",{type:"date",value:p,onChange:e=>g(e.target.value)}),(0,n.jsxs)("select",{value:l,onChange:e=>c(e.target.value),children:[(0,n.jsx)("option",{value:"",children:"All Categories"}),(0,n.jsx)("option",{value:"Boundary",children:"Boundary"}),(0,n.jsx)("option",{value:"Percentage",children:"Percentage"}),(0,n.jsx)("option",{value:"Bus_Rental",children:"Bus Rental"}),(0,n.jsx)("option",{value:"Other",children:"Other"})]}),(0,n.jsx)("button",{onClick:()=>N(!0),id:"addRevenue",children:"Add Revenue"})]})]}),(0,n.jsxs)("div",{className:"tableContainer",children:[(0,n.jsxs)("table",{children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:(0,n.jsx)("input",{type:"checkbox"})}),(0,n.jsx)("th",{children:"Collection Date"}),(0,n.jsx)("th",{children:"Source"}),(0,n.jsx)("th",{children:"Category"}),(0,n.jsx)("th",{children:"Amount"}),(0,n.jsx)("th",{children:"Action"})]})}),(0,n.jsx)("tbody",{children:U.map(e=>{let t,a=e.assignment_id?I.find(t=>t.assignment_id===e.assignment_id):null;return console.log("Assignment for revenue:",e.revenue_id,a),t="Other"===e.category?e.other_source||"N/A":B?"Loading...":a?P(a):e.assignment_id?"Assignment ".concat(e.assignment_id," not found"):"No assignment linked",(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:(0,n.jsx)("input",{type:"checkbox"})}),(0,n.jsx)("td",{children:v(e.collection_date)}),(0,n.jsx)("td",{children:t}),(0,n.jsx)("td",{children:"Other"===e.category?"Other":e.category.replace("_"," ")}),(0,n.jsxs)("td",{children:["â‚±",e.total_amount.toLocaleString()]}),(0,n.jsxs)("td",{className:"actionButtons",children:[(0,n.jsx)("button",{className:"editBtn",onClick:()=>{O(e),S(!0)},children:"Edit"}),(0,n.jsx)("button",{className:"deleteBtn",onClick:()=>G(e.revenue_id),children:"Delete"})]})]},e.revenue_id)})})]}),0===U.length&&!a&&(0,n.jsx)("p",{children:"No records found."})]}),(0,n.jsx)(d,{currentPage:x,totalPages:V,pageSize:f,onPageChange:j,onPageSizeChange:y}),b&&(0,n.jsx)(_,{onClose:()=>N(!1),onAddRevenue:J,assignments:T,currentUser:"user1"}),C&&R&&(0,n.jsx)(D,{record:{revenue_id:R.revenue_id,collection_date:R.collection_date,category:R.category,source:R.assignment_id?P(I.find(e=>e.assignment_id===R.assignment_id)):R.other_source||"N/A",amount:R.total_amount,assignment_id:R.assignment_id,other_source:R.other_source},onClose:()=>{S(!1),O(null)},onSave:z})]})};a(6475),a(6770);let O=e=>{let{onClose:t,onAddExpense:a,assignments:s,currentUser:o}=e,[i,l]=(0,r.useState)(""),[c,d]=(0,r.useState)(""),[u,h]=(0,r.useState)("operations"),[p,g]=(0,r.useState)([]),[x,j]=(0,r.useState)(!0),[_,f]=(0,r.useState)({category:"Fuel",assignment_id:"",receipt_id:"",total_amount:0,expense_date:new Date().toISOString().split("T")[0],created_by:o,other_source:"",other_category:""});(0,r.useEffect)(()=>{let e=()=>{let e=new Date;l(e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})),d(v(e))};e();let t=setInterval(e,6e4);return()=>clearInterval(t)},[]),(0,r.useEffect)(()=>{(async()=>{try{j(!0);let e=await fetch("/api/receipts");if(!e.ok)throw Error("Failed to fetch receipts");let t=(await e.json()).filter(e=>!e.is_expense_recorded).sort((e,t)=>new Date(e.transaction_date).getTime()-new Date(t.transaction_date).getTime());g(t)}catch(e){console.error("Error fetching receipts:",e),m().fire("Error","Failed to load receipts","error")}finally{j(!1)}})()},[]),(0,r.useEffect)(()=>{f(e=>({...e,assignment_id:"",receipt_id:"",total_amount:0,category:"operations"===u?"Fuel":"",other_source:"",other_category:""}))},[u]),(0,r.useEffect)(()=>{if(_.assignment_id){let e=s.find(e=>e.assignment_id===_.assignment_id);e&&f(t=>({...t,total_amount:e.trip_fuel_expense,category:"Fuel"}))}else if(_.receipt_id){let e=p.find(e=>e.receipt_id===_.receipt_id);e&&f(t=>({...t,total_amount:e.total_amount_due}))}},[_.assignment_id,_.receipt_id,s,p]);let y=s.filter(e=>!e.is_expense_recorded).sort((e,t)=>new Date(e.date_assigned).getTime()-new Date(t.date_assigned).getTime()),b=e=>{let{name:t,value:a}=e.target;"source"===t?h(a):"total_amount"===t&&"other"===u?f(e=>({...e,[t]:parseFloat(a)||0})):"category"===t&&"Other"===a?f(e=>({...e,category:a,other_category:""})):f(e=>({...e,[t]:a}))},N=async e=>{e.preventDefault();let{category:n,assignment_id:r,receipt_id:s,total_amount:i,expense_date:l,other_source:c,other_category:d}=_;if(!n||!l||!o)return void m().fire("Error","Please fill in all required fields","error");if("operations"===u&&!r)return void m().fire("Error","Please select an assignment","error");if("receipt"===u&&!s)return void m().fire("Error","Please select a receipt","error");if("other"===u&&!c)return void m().fire("Error","Please specify the source","error");if("Other"===n&&!d)return void m().fire("Error","Please specify the category","error");if((await m().fire({title:"Confirm Add",text:"Are you sure you want to add this expense record?",icon:"question",showCancelButton:!0,confirmButtonColor:"#13CE66",cancelButtonColor:"#961C1E",confirmButtonText:"Yes, add it!",background:"white"})).isConfirmed)try{await a({category:n,total_amount:i,expense_date:l,created_by:o,..."operations"===u?{assignment_id:r}:{},..."receipt"===u?{receipt_id:s}:{},..."other"===u?{other_source:c}:{},..."Other"===n?{other_category:d}:{}}),m().fire("Success","Expense added successfully","success"),t()}catch(t){console.error("Error adding expense:",t);let e=t instanceof Error?t.message:"An unknown error occurred";m().fire("Error","Failed to add expense: "+e,"error")}},C=e=>{let t="Airconditioned"===e.bus_type?"A":"O";return"â‚± ".concat(e.trip_fuel_expense," | ").concat(t," | ").concat(e.bus_bodynumber," - ").concat(e.bus_route," | ").concat(e.driver_name.split(" ").pop()," & ").concat(e.conductor_name.split(" ").pop()," | ").concat(v(e.date_assigned))},w=e=>"â‚± ".concat(e.total_amount_due," | ").concat(e.terms||"N/A"," | ").concat(e.supplier," | ").concat(v(e.transaction_date));return(0,n.jsx)("div",{className:"modalOverlay",children:(0,n.jsxs)("div",{className:"addExpenseModal",children:[(0,n.jsxs)("div",{className:"modalHeader",children:[(0,n.jsx)("h2",{children:"Add Expense"}),(0,n.jsxs)("div",{className:"timeDate",children:[(0,n.jsx)("div",{className:"currTime",children:i}),(0,n.jsx)("div",{className:"currDate",children:c})]})]}),(0,n.jsxs)("form",{onSubmit:N,children:[(0,n.jsxs)("div",{className:"formFieldsHorizontal",children:[(0,n.jsxs)("div",{className:"formLabels",children:[(0,n.jsx)("div",{className:"formLabel",children:"Source Type"}),(0,n.jsx)("div",{className:"formLabel",children:"Source"}),(0,n.jsx)("div",{className:"formLabel",children:"Category"}),(0,n.jsx)("div",{className:"formLabel",children:"Amount"}),(0,n.jsx)("div",{className:"formLabel",children:"Expense Date"})]}),(0,n.jsxs)("div",{className:"formInputs",children:[(0,n.jsx)("div",{className:"formField",children:(0,n.jsxs)("select",{name:"source",value:u,onChange:b,required:!0,className:"formSelect",children:[(0,n.jsx)("option",{value:"operations",children:"Operations"}),(0,n.jsx)("option",{value:"receipt",children:"Receipt"}),(0,n.jsx)("option",{value:"other",children:"Other"})]})}),(0,n.jsxs)("div",{className:"formField",children:["operations"===u&&(0,n.jsxs)("select",{name:"assignment_id",value:_.assignment_id,onChange:b,required:!0,className:"formSelect",children:[(0,n.jsx)("option",{value:"",children:"Select Assignment"}),y.map(e=>(0,n.jsx)("option",{value:e.assignment_id,children:C(e)},e.assignment_id))]}),"receipt"===u&&(0,n.jsxs)("select",{name:"receipt_id",value:_.receipt_id,onChange:b,required:!0,className:"formSelect",disabled:x,children:[(0,n.jsx)("option",{value:"",children:"Select Receipt"}),p.map(e=>(0,n.jsx)("option",{value:e.receipt_id,children:w(e)},e.receipt_id))]}),"other"===u&&(0,n.jsx)("input",{type:"text",name:"other_source",value:_.other_source,onChange:b,placeholder:"Specify source",required:!0,className:"formInput"})]}),(0,n.jsx)("div",{className:"formField",children:"Other"===_.category?(0,n.jsxs)("div",{className:"categoryInputWrapper",children:[(0,n.jsx)("input",{type:"text",name:"other_category",value:_.other_category||"",onChange:b,placeholder:"Specify category",required:!0,className:"formInput"}),(0,n.jsx)("button",{type:"button",className:"clearCategoryBtn",onClick:()=>f(e=>({...e,category:"Fuel",other_category:""})),children:"\xd7"})]}):(0,n.jsxs)("select",{name:"category",value:_.category,onChange:b,required:!0,className:"formSelect",disabled:"operations"===u,children:[(0,n.jsx)("option",{value:"",children:"Select Category"}),(0,n.jsx)("option",{value:"Fuel",children:"Fuel"}),(0,n.jsx)("option",{value:"Vehicle_Parts",children:"Vehicle Parts"}),(0,n.jsx)("option",{value:"Tools",children:"Tools"}),(0,n.jsx)("option",{value:"Equipment",children:"Equipment"}),(0,n.jsx)("option",{value:"Supplies",children:"Supplies"}),(0,n.jsx)("option",{value:"Other",children:"Other"})]})}),(0,n.jsx)("div",{className:"formField",children:(0,n.jsx)("input",{type:"number",name:"total_amount",value:_.total_amount||"",onChange:b,placeholder:"Enter amount",required:!0,className:"formInput",min:"0",step:"0.01",readOnly:"other"!==u})}),(0,n.jsx)("div",{className:"formField",children:(0,n.jsx)("input",{type:"date",name:"expense_date",value:_.expense_date,onChange:b,required:!0,className:"formInput"})})]})]}),(0,n.jsxs)("div",{className:"modalButtons",children:[(0,n.jsx)("button",{type:"button",className:"cancelButton",onClick:t,children:"Cancel"}),(0,n.jsx)("button",{type:"submit",className:"addButton",children:"Add"})]})]})]})})};a(4119);let T=e=>{let{record:t,onClose:a,onSave:s}=e,[o,i]=(0,r.useState)(t.expense_date),[l,c]=(0,r.useState)(t.amount),[d,u]=(0,r.useState)(t.other_source||""),[h,p]=(0,r.useState)(t.other_category||""),[g]=(0,r.useState)(t.amount),[x,j]=(0,r.useState)(!1),[v,_]=(0,r.useState)(0);(0,r.useEffect)(()=>{(async()=>{if(t.assignment_id)try{let e=await C(t.assignment_id);if(null==e?void 0:e.trip_fuel_expense){let a=Math.abs((t.amount-e.trip_fuel_expense)/e.trip_fuel_expense*100);_(a),j(a>10)}}catch(e){console.error("Error fetching assignment data:",e)}})()},[t.assignment_id,t.amount]);let f=e=>{if(c(e),g){let t=Math.abs((e-g)/g*100);_(t),j(t>10)}};return(0,n.jsx)("div",{className:"modalOverlay",children:(0,n.jsxs)("div",{className:"modalContent",children:[(0,n.jsxs)("div",{className:"modalHeader",children:[(0,n.jsx)("h2",{children:"Edit Expense"}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Category:"})," ","Other"===t.category?t.other_category||"Other":t.category]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Source:"})," ",t.source]})]}),(0,n.jsxs)("div",{className:"formGroup",children:[(0,n.jsx)("label",{children:"Expense Date"}),(0,n.jsx)("input",{type:"date",value:o,onChange:e=>i(e.target.value)})]}),"Other"===t.category&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"formGroup",children:[(0,n.jsx)("label",{children:"Category"}),(0,n.jsx)("input",{type:"text",value:h,onChange:e=>p(e.target.value),placeholder:"Specify category",required:!0})]}),(0,n.jsxs)("div",{className:"formGroup",children:[(0,n.jsx)("label",{children:"Source"}),(0,n.jsx)("input",{type:"text",value:d,onChange:e=>u(e.target.value),placeholder:"Specify source",required:!0})]})]}),(0,n.jsxs)("div",{className:"formGroup",children:[(0,n.jsx)("label",{children:"Amount"}),(0,n.jsxs)("div",{className:"amountInputGroup",children:[(0,n.jsx)("input",{type:"number",value:l,onChange:e=>f(parseFloat(e.target.value)),min:"0",step:"0.01"}),null!==g&&(0,n.jsxs)("div",{className:"amountReference",children:["Original Amount: â‚±",g.toLocaleString(),x&&(0,n.jsxs)("div",{className:"deviationWarning",children:["Deviation: ",v.toFixed(2),"%"]})]})]})]}),(0,n.jsxs)("div",{className:"modalButtons",children:[(0,n.jsx)("button",{onClick:a,className:"cancelBtn",children:"Cancel"}),(0,n.jsx)("button",{onClick:()=>o?"Other"!==t.category||h?void s({expense_id:t.expense_id,expense_date:o,total_amount:l,other_source:"Other"===t.category?d:void 0,other_category:"Other"===t.category?h:void 0}):void m().fire("Error","Please specify the category","error"):void m().fire("Error","Please fill in all required fields","error"),className:"saveBtn",children:"Save"})]})]})})};a(7230);let k=e=>{let{record:t,onClose:a}=e;return(0,n.jsx)("div",{className:"modalOverlay",children:(0,n.jsxs)("div",{className:"modalContent",children:[(0,n.jsxs)("div",{className:"modalHeader",children:[(0,n.jsx)("h2",{children:"View Expense"}),(0,n.jsx)("button",{className:"closeButton",onClick:a,children:"\xd7"})]}),(0,n.jsxs)("div",{className:"mainDetails",children:[(0,n.jsxs)("div",{className:"detailRow",children:[(0,n.jsx)("span",{className:"label",children:"Category:"}),(0,n.jsx)("span",{className:"value",children:"Other"===t.category?t.other_category||"Other":t.category.replace("_"," ")})]}),(0,n.jsxs)("div",{className:"detailRow",children:[(0,n.jsx)("span",{className:"label",children:"Amount:"}),(0,n.jsxs)("span",{className:"value",children:["â‚±",t.total_amount.toLocaleString()]})]}),(0,n.jsxs)("div",{className:"detailRow",children:[(0,n.jsx)("span",{className:"label",children:"Date:"}),(0,n.jsx)("span",{className:"value",children:v(t.expense_date)})]})]}),t.assignment&&(t.assignment?(0,n.jsxs)("div",{className:"operationsDetails",children:[(0,n.jsx)("h3",{children:"Operations Details"}),(0,n.jsxs)("div",{className:"detailRow",children:[(0,n.jsx)("span",{className:"label",children:"Bus Body Number:"}),(0,n.jsx)("span",{className:"value",children:t.assignment.bus_bodynumber})]}),(0,n.jsxs)("div",{className:"detailRow",children:[(0,n.jsx)("span",{className:"label",children:"Bus Plate Number:"}),(0,n.jsx)("span",{className:"value",children:t.assignment.bus_platenumber})]}),(0,n.jsxs)("div",{className:"detailRow",children:[(0,n.jsx)("span",{className:"label",children:"Bus Route:"}),(0,n.jsx)("span",{className:"value",children:t.assignment.bus_route})]}),(0,n.jsxs)("div",{className:"detailRow",children:[(0,n.jsx)("span",{className:"label",children:"Bus Type:"}),(0,n.jsx)("span",{className:"value",children:t.assignment.bus_type})]}),(0,n.jsxs)("div",{className:"detailRow",children:[(0,n.jsx)("span",{className:"label",children:"Driver:"}),(0,n.jsx)("span",{className:"value",children:t.assignment.driver_name})]}),(0,n.jsxs)("div",{className:"detailRow",children:[(0,n.jsx)("span",{className:"label",children:"Conductor:"}),(0,n.jsx)("span",{className:"value",children:t.assignment.conductor_name})]}),(0,n.jsxs)("div",{className:"detailRow",children:[(0,n.jsx)("span",{className:"label",children:"Date Assigned:"}),(0,n.jsx)("span",{className:"value",children:v(t.assignment.date_assigned)})]}),(0,n.jsxs)("div",{className:"detailRow",children:[(0,n.jsx)("span",{className:"label",children:"Trip Fuel Expense:"}),(0,n.jsxs)("span",{className:"value",children:["â‚±",t.assignment.trip_fuel_expense.toLocaleString()]})]})]}):null),t.receipt&&(t.receipt?(0,n.jsxs)("div",{className:"receiptDetails",children:[(0,n.jsx)("h3",{children:"Receipt Details"}),(0,n.jsxs)("div",{className:"detailRow",children:[(0,n.jsx)("span",{className:"label",children:"Supplier:"}),(0,n.jsx)("span",{className:"value",children:t.receipt.supplier})]}),(0,n.jsxs)("div",{className:"detailRow",children:[(0,n.jsx)("span",{className:"label",children:"Transaction Date:"}),(0,n.jsx)("span",{className:"value",children:v(t.receipt.transaction_date)})]}),(0,n.jsxs)("div",{className:"detailRow",children:[(0,n.jsx)("span",{className:"label",children:"VAT Reg TIN:"}),(0,n.jsx)("span",{className:"value",children:t.receipt.vat_reg_tin||"N/A"})]}),(0,n.jsxs)("div",{className:"detailRow",children:[(0,n.jsx)("span",{className:"label",children:"Terms:"}),(0,n.jsx)("span",{className:"value",children:t.receipt.terms||"N/A"})]}),(0,n.jsxs)("div",{className:"detailRow",children:[(0,n.jsx)("span",{className:"label",children:"Date Paid:"}),(0,n.jsx)("span",{className:"value",children:t.receipt.date_paid?v(t.receipt.date_paid):"N/A"})]}),(0,n.jsxs)("div",{className:"detailRow",children:[(0,n.jsx)("span",{className:"label",children:"Status:"}),(0,n.jsx)("span",{className:"value",children:t.receipt.status})]}),(0,n.jsxs)("div",{className:"detailRow",children:[(0,n.jsx)("span",{className:"label",children:"Total Amount:"}),(0,n.jsxs)("span",{className:"value",children:["â‚±",Number(t.receipt.total_amount).toLocaleString()]})]}),(0,n.jsxs)("div",{className:"detailRow",children:[(0,n.jsx)("span",{className:"label",children:"VAT Amount:"}),(0,n.jsxs)("span",{className:"value",children:["â‚±",t.receipt.vat_amount?Number(t.receipt.vat_amount).toLocaleString():"N/A"]})]}),(0,n.jsxs)("div",{className:"detailRow",children:[(0,n.jsx)("span",{className:"label",children:"Total Amount Due:"}),(0,n.jsxs)("span",{className:"value",children:["â‚±",Number(t.receipt.total_amount_due).toLocaleString()]})]}),t.receipt.items&&t.receipt.items.length>0&&(0,n.jsxs)("div",{className:"itemsSection",children:[(0,n.jsx)("h4",{children:"Items"}),(0,n.jsxs)("table",{children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"Item Name"}),(0,n.jsx)("th",{children:"Unit"}),(0,n.jsx)("th",{children:"Quantity"}),(0,n.jsx)("th",{children:"Unit Price"}),(0,n.jsx)("th",{children:"Total Price"})]})}),(0,n.jsx)("tbody",{children:t.receipt.items.map((e,t)=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:e.item_name}),(0,n.jsx)("td",{children:e.unit}),(0,n.jsx)("td",{children:Number(e.quantity).toLocaleString()}),(0,n.jsxs)("td",{children:["â‚±",Number(e.unit_price).toLocaleString()]}),(0,n.jsxs)("td",{children:["â‚±",Number(e.total_price).toLocaleString()]})]},t))})]})]})]}):null),!t.assignment&&!t.receipt&&(0,n.jsxs)("div",{className:"otherDetails",children:[(0,n.jsx)("h3",{children:"Expense Source Details"}),(0,n.jsx)("div",{className:"detailRow",children:(0,n.jsx)("span",{className:"value",children:t.other_source||"N/A"})})]}),(0,n.jsx)("div",{className:"modalFooter",children:(0,n.jsx)("button",{className:"closeBtn",onClick:a,children:"Close"})})]})})},B=()=>{let[e,t]=(0,r.useState)([]),[a,s]=(0,r.useState)(!0),[o,i]=(0,r.useState)(""),[l,c]=(0,r.useState)(""),[u,h]=(0,r.useState)(""),[p,g]=(0,r.useState)(""),[x,j]=(0,r.useState)(1),[_,f]=(0,r.useState)(5),[y,b]=(0,r.useState)(!1),[N,C]=(0,r.useState)(!1),[w,D]=(0,r.useState)(!1),[R,B]=(0,r.useState)(null),[A,I]=(0,r.useState)(null),[F,P]=(0,r.useState)([]),[L,M]=(0,r.useState)(!0),[q,U]=(0,r.useState)([]),[V,J]=(0,r.useState)(Date.now()),G=e=>{let t="Airconditioned"===e.bus_type?"A":"O";return"".concat(t," | ").concat(e.bus_bodynumber," - ").concat(e.bus_route," | ").concat(e.driver_name.split(" ").pop()," & ").concat(e.conductor_name.split(" ").pop()," | ").concat(v(e.date_assigned))},z=e=>"".concat(e.terms||"N/A"," | ").concat(e.supplier," | ").concat(v(e.transaction_date)),H=async()=>{try{let e=await fetch("/api/expenses");if(!e.ok)throw Error("Failed to fetch expenses");let a=await e.json();t(a)}catch(e){console.error("Error fetching expenses:",e),m().fire("Error","Failed to load expenses","error")}},Y=async()=>{try{M(!0);let e=await S();P(e);let t=await E();U(t)}catch(e){console.error("Error fetching assignments:",e),m().fire("Error","Failed to load assignments","error")}finally{M(!1)}};(0,r.useEffect)(()=>{(async()=>{s(!0),await Promise.all([H(),Y()]),s(!1)})()},[]),(0,r.useEffect)(()=>{let e=setInterval(()=>{J(Date.now())},3e4);return()=>clearInterval(e)},[]),(0,r.useEffect)(()=>{a||y||N||(H(),Y())},[V,a,y,N]);let X=e.filter(e=>{var t;let a=((null==(t=e.category)?void 0:t.toLowerCase())||"").includes(o.toLowerCase()),n=!l||e.category===l,r=(!u||e.expense_date>=u)&&(!p||e.expense_date<=p);return a&&n&&r}),W=x*_,K=X.slice(W-_,W),Q=Math.ceil(X.length/_),Z=async e=>{try{let a=await fetch("/api/expenses",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!a.ok)throw Error("Create failed");let n=await a.json();t(e=>[{expense_id:n.expense_id,category:n.category,total_amount:Number(n.total_amount),expense_date:new Date(n.expense_date).toISOString().split("T")[0],created_by:n.created_by,assignment_id:n.assignment_id,receipt_id:n.receipt_id,other_source:n.other_source,other_category:n.other_category,receipt:n.receipt},...e]),J(Date.now()),m().fire("Success","Expense added successfully","success"),b(!1)}catch(e){console.error("Create error:",e),m().fire("Error","Failed to add expense: "+(e instanceof Error?e.message:"Unknown error"),"error")}},$=async e=>{if((await m().fire({title:"Are you sure?",text:"This will delete the record permanently.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#13CE66",cancelButtonColor:"#961C1E",confirmButtonText:"Yes, delete it!",background:"white"})).isConfirmed)try{if(!(await fetch("/api/expenses/".concat(e),{method:"DELETE"})).ok)throw Error("Delete failed");t(t=>t.filter(t=>t.expense_id!==e)),m().fire("Deleted!","Record deleted successfully","success")}catch(e){console.error("Delete error:",e),m().fire("Error","Failed to delete record","error")}},ee=async e=>{try{let a=await fetch("/api/expenses/".concat(e.expense_id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!a.ok)throw Error("Update failed");let n=await a.json();t(t=>{let a=t.filter(t=>t.expense_id!==e.expense_id);return[{expense_id:n.expense_id,category:n.category,total_amount:Number(n.total_amount),expense_date:new Date(n.expense_date).toISOString().split("T")[0],created_by:n.created_by,assignment_id:n.assignment_id,receipt_id:n.receipt_id,other_source:n.other_source,receipt:n.receipt},...a]}),C(!1),B(null),m().fire("Success","Record updated successfully","success")}catch(e){console.error("Update error:",e),m().fire("Error","Failed to update record","error")}},et=e=>{I(e),D(!0)},ea=()=>{let e=new Date,t=e.toISOString().replace(/[:.]/g,"-").split("T")[1].slice(0,8),a=e.toISOString().split("T")[0],n="expense_records";if(l&&(n+="_".concat(l.toLowerCase().replace("_","-"))),u||p){let e=u?new Date(u).toISOString().split("T")[0]:"all",t=p?new Date(p).toISOString().split("T")[0]:"present";n+="_".concat(e,"_to_").concat(t)}return n+="_".concat(a,"_").concat(t),"".concat(n,".csv")},en=()=>{let e=["Expense Date","Category","Amount","Source Type"];return l?"Other"===l?[...e,"Other Source Description","Other Category"]:[...e,"Bus Type","Body Number","Route","Driver Name","Conductor Name","Assignment Date","Receipt Supplier","Receipt Transaction Date","Receipt VAT TIN","Receipt Terms","Receipt Status","Receipt VAT Amount","Receipt Total Due"]:[...e,"Bus Type","Body Number","Route","Driver Name","Conductor Name","Assignment Date","Receipt Supplier","Receipt Transaction Date","Receipt VAT TIN","Receipt Terms","Receipt Status","Receipt VAT Amount","Receipt Total Due","Other Source Description","Other Category"]},er=()=>{let e="Export Details:\n";if(e+="Category: ".concat(l||"All Categories","\n"),u||p){let t=u?v(u):"Beginning",a=p?v(p):"Present";e+="Date Range: ".concat(t," to ").concat(a,"\n")}else e+="Date Range: All Dates\n";return e+="Total Records: ".concat(X.length,"\n"),e+="Export Time: ".concat(new Date().toISOString(),"\n"),e+="Exported Columns: ".concat(en().join(", "))},es=async()=>{try{let e=await fetch("/api/generate-export-id");if(!e.ok)throw Error("Failed to generate export ID");let{exportId:t}=await e.json(),a=er();if(!(await fetch("/api/auditlogs/export",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"EXPORT",table_affected:"ExpenseRecord",record_id:t,performed_by:"ftms_user",details:a})})).ok)throw Error("Failed to create audit log");return t}catch(e){throw console.error("Failed to create audit log:",e),e}},eo=(e,t)=>{let a=en(),n=a.join(",")+"\n",r=e.map(e=>{let t=e.assignment_id?q.find(t=>t.assignment_id===e.assignment_id):null,n=e=>{if(null==e)return"";let t=String(e);return t.includes(",")||t.includes('"')||t.includes("\n")?'"'.concat(t.replace(/"/g,'""'),'"'):t},r=[];return a.forEach(a=>{var s,o,i,l,c,d,u;switch(a){case"Expense Date":r.push(n(v(e.expense_date)));break;case"Category":r.push(n("Other"===e.category?e.other_category||"Other":e.category.replace("_"," ")));break;case"Amount":r.push(n(Number(e.total_amount).toFixed(2)));break;case"Source Type":r.push(n(t?"Assignment":e.receipt?"Receipt":"Other"));break;case"Bus Type":r.push(n(null==t?void 0:t.bus_type));break;case"Body Number":r.push(n(null==t?void 0:t.bus_bodynumber));break;case"Route":r.push(n(null==t?void 0:t.bus_route));break;case"Driver Name":r.push(n(null==t?void 0:t.driver_name));break;case"Conductor Name":r.push(n(null==t?void 0:t.conductor_name));break;case"Assignment Date":r.push(n((null==t?void 0:t.date_assigned)?v(t.date_assigned):""));break;case"Receipt Supplier":r.push(n(null==(s=e.receipt)?void 0:s.supplier));break;case"Receipt Transaction Date":r.push(n((null==(o=e.receipt)?void 0:o.transaction_date)?v(e.receipt.transaction_date):""));break;case"Receipt VAT TIN":r.push(n(null==(i=e.receipt)?void 0:i.vat_reg_tin));break;case"Receipt Terms":r.push(n(null==(l=e.receipt)?void 0:l.terms));break;case"Receipt Status":r.push(n(null==(c=e.receipt)?void 0:c.status));break;case"Receipt VAT Amount":r.push(n((null==(d=e.receipt)?void 0:d.vat_amount)?Number(e.receipt.vat_amount).toFixed(2):""));break;case"Receipt Total Due":r.push(n((null==(u=e.receipt)?void 0:u.total_amount_due)?Number(e.receipt.total_amount_due).toFixed(2):""));break;case"Other Source Description":r.push(n(e.other_source));break;case"Other Category":r.push(n(e.other_category));break;default:r.push("")}}),r.join(",")}).join("\n"),s=new Blob([(()=>{let a='"# Expense Records Export","","","","","","","","","","","","","","",""\n';if(a+='"# Export ID:","'.concat(t,'","","","","","","","","","","","","","",""\n'),a+='"# Generated:","'.concat(v(new Date),'","","","","","","","","","","","","","",""\n'),l?a+='"# Category:","'.concat(l,'","","","","","","","","","","","","","",""\n'):a+='"# Category:","All Categories","","","","","","","","","","","","","",""\n',u||p){let e=u?v(u):"Beginning",t=p?v(p):"Present";a+='"# Date Range:","'.concat(e," to ").concat(t,'","","","","","","","","","","","","","",""\n')}else a+='"# Date Range:","All Dates","","","","","","","","","","","","","",""\n';return a+'"# Total Records:","'.concat(e.length,'","","","","","","","","","","","","","",""\n\n')})()+n+r],{type:"text/csv;charset=utf-8;"}),o=URL.createObjectURL(s),i=document.createElement("a");i.href=o,i.download=ea(),document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(o)};return(0,n.jsxs)("div",{className:"expensePage",children:[(a||L)&&(0,n.jsx)("div",{className:"loading",children:"Loading..."}),(0,n.jsx)("div",{className:"importExport",children:(0,n.jsx)("button",{onClick:()=>{m().fire({title:"Confirm Export",html:(()=>{let e="<strong>Expense Records Export</strong><br/><br/>";if(l?e+="<strong>Category:</strong> ".concat(l,"<br/>"):e+="<strong>Category:</strong> All Categories<br/>",u||p){let t=u?v(u):"Beginning",a=p?v(p):"Present";e+="<strong>Date Range:</strong> ".concat(t," to ").concat(a,"<br/>")}else e+="<strong>Date Range:</strong> All Dates<br/>";return e+"<strong>Total Records:</strong> ".concat(X.length)})(),icon:"question",showCancelButton:!0,confirmButtonColor:"#13CE66",cancelButtonColor:"#961C1E",confirmButtonText:"Export",background:"white"}).then(async e=>{if(e.isConfirmed)try{let e=await es();eo(X,e),m().fire("Success","Export completed successfully","success")}catch(e){console.error("Export error:",e),m().fire("Error","Failed to export data","error")}})},children:"Export CSV"})}),(0,n.jsxs)("div",{className:"settings",children:[(0,n.jsx)("input",{type:"text",placeholder:"Search by category...",value:o,onChange:e=>i(e.target.value)}),(0,n.jsxs)("div",{className:"filters",children:[(0,n.jsx)("input",{type:"date",value:u,onChange:e=>h(e.target.value)}),(0,n.jsx)("input",{type:"date",value:p,onChange:e=>g(e.target.value)}),(0,n.jsxs)("select",{value:l,onChange:e=>c(e.target.value),children:[(0,n.jsx)("option",{value:"",children:"All Categories"}),(0,n.jsx)("option",{value:"Fuel",children:"Fuel"}),(0,n.jsx)("option",{value:"Vehicle_Parts",children:"Vehicle Parts"}),(0,n.jsx)("option",{value:"Tools",children:"Tools"}),(0,n.jsx)("option",{value:"Equipment",children:"Equipment"}),(0,n.jsx)("option",{value:"Supplies",children:"Supplies"}),(0,n.jsx)("option",{value:"Other",children:"Other"})]}),(0,n.jsx)("button",{onClick:()=>b(!0),id:"addExpense",children:"Add Expense"})]})]}),(0,n.jsxs)("div",{className:"tableContainer",children:[(0,n.jsxs)("table",{children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"Expense Date"}),(0,n.jsx)("th",{children:"Source"}),(0,n.jsx)("th",{children:"Category"}),(0,n.jsx)("th",{children:"Amount"}),(0,n.jsx)("th",{children:"Action"})]})}),(0,n.jsx)("tbody",{children:K.map(e=>{let t;if(e.assignment_id){let a=q.find(t=>t.assignment_id===e.assignment_id);t=a?G(a):"Assignment ".concat(e.assignment_id," not found")}else t=e.receipt?z(e.receipt):e.other_source||"N/A";return(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:v(e.expense_date)}),(0,n.jsx)("td",{children:t}),(0,n.jsx)("td",{children:"Other"===e.category?e.other_category||"Other":e.category.replace("_"," ")}),(0,n.jsxs)("td",{children:["â‚±",e.total_amount.toLocaleString()]}),(0,n.jsxs)("td",{className:"actionButtons",children:[(0,n.jsx)("button",{className:"viewBtn",onClick:()=>et(e),children:"View"}),(0,n.jsx)("button",{className:"editBtn",onClick:()=>{B(e),C(!0)},children:"Edit"}),(0,n.jsx)("button",{className:"deleteBtn",onClick:()=>$(e.expense_id),children:"Delete"})]})]},e.expense_id)})})]}),0===K.length&&!a&&(0,n.jsx)("p",{children:"No records found."})]}),(0,n.jsx)(d,{currentPage:x,totalPages:Q,pageSize:_,onPageChange:j,onPageSizeChange:f}),y&&(0,n.jsx)(O,{onClose:()=>b(!1),onAddExpense:Z,assignments:F,currentUser:"ftms_user"}),N&&R&&(0,n.jsx)(T,{record:{expense_id:R.expense_id,expense_date:R.expense_date,category:R.category,source:R.assignment_id?G(q.find(e=>e.assignment_id===R.assignment_id)):R.receipt?z(R.receipt):R.other_source||"N/A",amount:R.total_amount,assignment_id:R.assignment_id,receipt_id:R.receipt_id,other_source:R.other_source},onClose:()=>{C(!1),B(null)},onSave:ee}),w&&A&&(0,n.jsx)(k,{record:{expense_id:A.expense_id,category:A.category,other_category:A.other_category,total_amount:A.total_amount,expense_date:A.expense_date,assignment:A.assignment_id?q.find(e=>e.assignment_id===A.assignment_id):void 0,receipt:A.receipt,other_source:A.other_source},onClose:()=>{I(null),D(!1)}})]})};var A=a(4065),I=a(2502),F=a(2834);a(4423),I.t1.register(I.Bs,I.m_,I.s$,F.A);let P=e=>{let{revenueData:t,expenseData:a}=e,r={Boundary:"#4373A1",Percentage:"#708D81",Bus_Rental:"#F4D58D",Other:"#001427"},s={Fuel:"#8D0801",Vehicle_Parts:"#bf0603",Tools:"#8b0000",Equipment:"#590202",Supplies:"#720000",Other:"#400000"},o={labels:[...Object.keys(t).map(e=>"Revenue - ".concat(e.replace("_"," "))),...Object.keys(a).map(e=>"Expense - ".concat(e.replace("_"," ")))],datasets:[{data:[...Object.values(t),...Object.values(a)],backgroundColor:[...Object.keys(t).map(e=>r[e]),...Object.keys(a).map(e=>s[e])],borderWidth:1}]};return(0,n.jsx)("div",{className:"pieChartContainer",children:(0,n.jsx)(A.Fq,{data:o,options:{plugins:{legend:{position:"right",labels:{font:{size:12},color:"#000000"}},datalabels:{color:"#fff",textShadowColor:"rgba(0, 0, 0, 0.6)",textAlign:"center",textShadowBlur:8,formatter:e=>{let n=(e/(Object.values(t).reduce((e,t)=>e+t,0)+Object.values(a).reduce((e,t)=>e+t,0))*100).toFixed(1);return"â‚±".concat(e.toLocaleString(),"\n(").concat(n,"%)")},font:{weight:"bold",size:12},anchor:"center",align:"center",offset:10}},layout:{padding:20}},plugins:[F.A]})})};var L=a(3895),M=a.n(L);let q=e=>{let{isOpen:t,onClose:a,onConfirm:r,dateFilter:s,dateFrom:o,dateTo:i,dashboardData:l}=e;return t?(0,n.jsx)("div",{className:M().modalOverlay,children:(0,n.jsxs)("div",{className:M().modalContent,children:[(0,n.jsx)("h2",{children:"Confirm Export"}),(0,n.jsxs)("div",{className:M().summarySection,children:[(0,n.jsx)("h3",{children:"Data Summary"}),(0,n.jsxs)("div",{className:M().dateRange,children:[(0,n.jsx)("strong",{children:"Date Range:"})," ",(()=>{switch(s){case"Day":return"Today";case"Month":return"This Month";case"Year":return"This Year";case"Custom":return"".concat(o," to ").concat(i);default:return"All Time"}})()]}),(0,n.jsxs)("div",{className:M().financialSummary,children:[(0,n.jsxs)("div",{className:M().summaryItem,children:[(0,n.jsx)("strong",{children:"Total Revenue:"})," â‚±",l.revenue.total.toLocaleString()]}),(0,n.jsxs)("div",{className:M().summaryItem,children:[(0,n.jsx)("strong",{children:"Total Expenses:"})," â‚±",l.expense.total.toLocaleString()]}),(0,n.jsxs)("div",{className:M().summaryItem,children:[(0,n.jsx)("strong",{children:"Net Profit:"})," â‚±",l.profit.toLocaleString()]})]}),(0,n.jsxs)("div",{className:M().categoryBreakdown,children:[(0,n.jsxs)("div",{className:M().categorySection,children:[(0,n.jsx)("h4",{children:"Revenue Categories:"}),Object.entries(l.revenue.byCategory).map(e=>{let[t,a]=e;return(0,n.jsxs)("div",{className:M().categoryItem,children:[(0,n.jsxs)("span",{children:[t.replace("_"," "),":"]}),(0,n.jsxs)("span",{children:["â‚±",a.toLocaleString()]})]},t)})]}),(0,n.jsxs)("div",{className:M().categorySection,children:[(0,n.jsx)("h4",{children:"Expense Categories:"}),Object.entries(l.expense.byCategory).map(e=>{let[t,a]=e;return(0,n.jsxs)("div",{className:M().categoryItem,children:[(0,n.jsxs)("span",{children:[t.replace("_"," "),":"]}),(0,n.jsxs)("span",{children:["â‚±",a.toLocaleString()]})]},t)})]})]})]}),(0,n.jsxs)("div",{className:M().modalActions,children:[(0,n.jsx)("button",{onClick:a,className:M().cancelButton,children:"Cancel"}),(0,n.jsx)("button",{onClick:r,className:M().confirmButton,children:"Confirm Export"})]})]})}):null};async function U(e){try{let t=await fetch("/api/audit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status))}catch(e){console.error("Failed to log audit:",e)}}a(9991);let V=()=>{let[e,t]=(0,r.useState)(""),[a,s]=(0,r.useState)(""),[o,i]=(0,r.useState)(""),[l,c]=(0,r.useState)(!1),[d,u]=(0,r.useState)({revenue:{total:0,byCategory:{}},expense:{total:0,byCategory:{}},profit:0}),m=(0,r.useCallback)(async()=>{try{let t=new URLSearchParams;"Custom"===e&&a&&o?(t.append("dateFrom",a),t.append("dateTo",o)):e&&t.append("dateFilter",e);let n=await fetch("/api/revenues?".concat(t)),r=await n.json(),s=await fetch("/api/expenses?".concat(t)),i=await s.json(),l=r.reduce((e,t)=>(e[t.category]=(e[t.category]||0)+Number(t.total_amount),e),{}),c=i.reduce((e,t)=>(e[t.category]=(e[t.category]||0)+Number(t.total_amount),e),{}),d=Object.values(l).reduce((e,t)=>e+t,0),m=Object.values(c).reduce((e,t)=>e+t,0);u({revenue:{total:d,byCategory:l},expense:{total:m,byCategory:c},profit:d-m})}catch(e){console.error("Error fetching dashboard data:",e)}},[e,a,o]);(0,r.useEffect)(()=>{m();let e=setInterval(m,3e4);return()=>clearInterval(e)},[m]);let h=()=>{let t=new Date,n=t.toISOString().replace(/[:.]/g,"-").split("T")[1].slice(0,8),r=t.toISOString().split("T")[0],s="dashboard_report";return e&&(s+="_".concat(e.toLowerCase())),"Custom"===e&&a&&o&&(s+="_".concat(a,"_to_").concat(o)),s+="_".concat(r,"_").concat(n),"".concat(s,".xlsx")},p=async()=>{try{let t=await fetch("/api/export/dashboard",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({dateFilter:e,dateFrom:a,dateTo:o,data:d})});if(t.ok){let n=await t.blob(),r=window.URL.createObjectURL(n),s=document.createElement("a");s.href=r;let i=h();s.download=i,document.body.appendChild(s),s.click(),window.URL.revokeObjectURL(r),c(!1);let l=await fetch("/api/generate-export-id");if(!l.ok)throw Error("Failed to generate export ID");let{exportId:u}=await l.json();await U({action:"EXPORT",table_affected:"Revenue AND Expense",record_id:u,performed_by:"ftms_user",details:"Exported dashboard report (".concat(i,") with date filter: ").concat(e||"All").concat("Custom"===e?", range: ".concat(a," to ").concat(o):"",". Summary - Revenue: â‚±").concat(d.revenue.total.toLocaleString(),", Expenses: â‚±").concat(d.expense.total.toLocaleString(),", Profit: â‚±").concat(d.profit.toLocaleString())})}}catch(e){console.error("Error exporting dashboard data:",e)}};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"dashboardPage",children:(0,n.jsxs)("div",{className:"accounting",children:[(0,n.jsxs)("div",{className:"settings",children:[(0,n.jsxs)("div",{className:"filterDate",children:[(0,n.jsxs)("div",{className:"filter",children:[(0,n.jsx)("label",{htmlFor:"dateFilter",children:"Date By:"}),(0,n.jsxs)("select",{value:e,id:"dateFilter",onChange:e=>{t(e.target.value),"Custom"!==e.target.value&&(s(""),i(""))},children:[(0,n.jsx)("option",{value:"",children:"All"}),(0,n.jsx)("option",{value:"Day",children:"Today"}),(0,n.jsx)("option",{value:"Month",children:"This Month"}),(0,n.jsx)("option",{value:"Year",children:"This Year"}),(0,n.jsx)("option",{value:"Custom",children:"Custom"})]})]}),"Custom"===e&&(0,n.jsxs)("div",{className:"dateRangePicker",children:[(0,n.jsxs)("div",{className:"date",children:[(0,n.jsx)("label",{htmlFor:"startDate",children:"Start Date:"}),(0,n.jsx)("input",{type:"date",id:"startDate",name:"startDate",value:a,onChange:e=>{s(e.target.value),o&&m()}})]}),(0,n.jsxs)("div",{className:"date",children:[(0,n.jsx)("label",{htmlFor:"endDate",children:"End Date:"}),(0,n.jsx)("input",{type:"date",id:"endDate",name:"endDate",value:o,onChange:e=>{i(e.target.value),a&&m()}})]})]})]}),(0,n.jsx)("div",{className:"exportButton",children:(0,n.jsx)("button",{onClick:()=>c(!0),children:"Export"})})]}),(0,n.jsxs)("div",{className:"dataContainer",children:[(0,n.jsxs)("div",{className:"data",children:[(0,n.jsxs)("div",{className:"dataGrid",id:"revenue",children:[(0,n.jsx)("div",{className:"title",children:(0,n.jsx)("h2",{children:"Revenue"})}),(0,n.jsxs)("p",{children:["â‚±",d.revenue.total.toLocaleString()]}),(0,n.jsx)("div",{className:"categoryBreakdown",children:Object.entries(d.revenue.byCategory).map(e=>{let[t,a]=e;return(0,n.jsxs)("div",{className:"categoryItem",children:[(0,n.jsx)("span",{children:t.replace("_"," ")}),(0,n.jsxs)("span",{children:["â‚±",a.toLocaleString()]})]},t)})})]}),(0,n.jsxs)("div",{className:"dataGrid",id:"expenses",children:[(0,n.jsx)("div",{className:"title",children:(0,n.jsx)("h2",{children:"Expenses"})}),(0,n.jsxs)("p",{children:["â‚±",d.expense.total.toLocaleString()]}),(0,n.jsx)("div",{className:"categoryBreakdown",children:Object.entries(d.expense.byCategory).map(e=>{let[t,a]=e;return(0,n.jsxs)("div",{className:"categoryItem",children:[(0,n.jsx)("span",{children:t.replace("_"," ")}),(0,n.jsxs)("span",{children:["â‚±",a.toLocaleString()]})]},t)})})]}),(0,n.jsxs)("div",{className:"dataGrid",id:"profit",children:[(0,n.jsx)("div",{className:"title",children:(0,n.jsx)("h2",{children:"Profit"})}),(0,n.jsxs)("p",{children:["â‚±",d.profit.toLocaleString()]})]}),(0,n.jsx)("div",{className:"dataGrid",id:"emoji",children:(0,n.jsx)("div",{className:"emoji",children:(0,n.jsx)("video",{src:(e=>e<0||e<=5e4?"/sad.webm":"/happy.webm")(d.profit),autoPlay:!0,loop:!0,muted:!0})})})]}),(0,n.jsxs)("div",{className:"graph",children:[(0,n.jsx)("div",{className:"title",children:(0,n.jsx)("h2",{children:"Financial Overview"})}),(0,n.jsx)(P,{revenueData:d.revenue.byCategory,expenseData:d.expense.byCategory})]})]})]})}),(0,n.jsx)(q,{isOpen:l,onClose:()=>c(!1),onConfirm:p,dateFilter:e,dateFrom:a,dateTo:o,dashboardData:d})]})};a(8570);let J=e=>new Date(e).toLocaleString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}),G=e=>{let{log:t,onClose:a}=e;return t?(0,n.jsx)("div",{className:"modalOverlay",children:(0,n.jsxs)("div",{className:"viewDetailsModal",children:[(0,n.jsxs)("div",{className:"modalHeader",children:[(0,n.jsx)("h2",{children:"Audit Log Details"}),(0,n.jsx)("button",{onClick:a,className:"closeButton",children:"\xd7"})]}),(0,n.jsxs)("div",{className:"modalContent",children:[(0,n.jsxs)("div",{className:"detailRow",children:[(0,n.jsx)("strong",{children:"Date & Time:"}),(0,n.jsx)("span",{children:J(t.timestamp)})]}),(0,n.jsxs)("div",{className:"detailRow",children:[(0,n.jsx)("strong",{children:"Action:"}),(0,n.jsx)("span",{children:t.action})]}),(0,n.jsxs)("div",{className:"detailRow",children:[(0,n.jsx)("strong",{children:"Table:"}),(0,n.jsx)("span",{children:t.table_affected})]}),(0,n.jsxs)("div",{className:"detailRow",children:[(0,n.jsx)("strong",{children:"Record ID:"}),(0,n.jsx)("span",{children:t.record_id})]}),(0,n.jsxs)("div",{className:"detailRow",children:[(0,n.jsx)("strong",{children:"Performed By:"}),(0,n.jsx)("span",{children:t.performed_by})]}),(0,n.jsxs)("div",{className:"detailRow",children:[(0,n.jsx)("strong",{children:"IP Address:"}),(0,n.jsx)("span",{children:t.ip_address||"N/A"})]}),(0,n.jsxs)("div",{className:"detailRow",children:[(0,n.jsx)("strong",{children:"Details:"}),(0,n.jsx)("span",{className:"fullDetails",children:t.details})]})]})]})}):null},z=()=>{let[e,t]=(0,r.useState)([]),[a,s]=(0,r.useState)(!0),[o,i]=(0,r.useState)(""),[l,c]=(0,r.useState)(""),[u,h]=(0,r.useState)(""),[p,g]=(0,r.useState)(""),[x,j]=(0,r.useState)(1),[v,_]=(0,r.useState)(10),[f,y]=(0,r.useState)(null);(0,r.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/auditlogs");if(!e.ok)throw Error("Failed to fetch audit logs");let a=await e.json();t(a)}catch(e){console.error("Error fetching audit logs:",e)}finally{s(!1)}})()},[]);let b=e.filter(e=>{let t=e.details.toLowerCase().includes(o.toLowerCase())||e.performed_by.toLowerCase().includes(o.toLowerCase())||e.action.toLowerCase().includes(o.toLowerCase()),a=!l||e.table_affected===l,n=new Date(e.timestamp).toISOString().split("T")[0],r=(!u||n>=u)&&(!p||n<=p);return t&&a&&r}),N=x*v,C=b.slice(N-v,N),w=Math.ceil(b.length/v),S=async()=>{try{if(0===b.length&&!(await m().fire({title:"Warning",text:"No records found with the current filters. Do you want to proceed with exporting an empty dataset?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#13CE66",cancelButtonColor:"#FF4949",confirmButtonText:"Yes, export empty dataset",cancelButtonText:"Cancel"})).isConfirmed||!(await m().fire({title:"Confirm Export",html:'\n          <div class="exportConfirmation">\n            <p><strong>Date Range:</strong> '.concat(u?J(u):"Start"," to ").concat(p?J(p):"End","</p>\n            <p><strong>Table Filter:</strong> ").concat(l||"All Tables","</p>\n            <p><strong>Search Term:</strong> ").concat(o||"None","</p>\n            <p><strong>Number of Records:</strong> ").concat(b.length,"</p>\n          </div>\n        "),icon:"question",showCancelButton:!0,confirmButtonColor:"#13CE66",cancelButtonColor:"#FF4949",confirmButtonText:"Export",cancelButtonText:"Cancel"})).isConfirmed)return;m().fire({title:"Exporting...",text:"Please wait while we prepare your export.",allowOutsideClick:!1,allowEscapeKey:!1,allowEnterKey:!1,didOpen:()=>{m().showLoading()}});let e=await fetch("/api/generate-export-id");if(!e.ok)throw Error("Failed to generate export ID");let{exportId:t}=await e.json();await fetch("/api/auditlogs/export",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"EXPORT",table_affected:"AuditLog",record_id:t,details:"Exported audit logs with filters - Date Range: ".concat(u||"Start"," to ").concat(p||"End",", Table: ").concat(l||"All",", Search: ").concat(o||"None",", Records: ").concat(b.length)})});let a=b.map(e=>({"Date & Time":J(e.timestamp),Action:e.action,Table:e.table_affected,"Record ID":e.record_id,"Performed By":e.performed_by,"IP Address":e.ip_address||"N/A",Details:e.details})),n=["Date & Time","Action","Table","Record ID","Performed By","IP Address","Details"],r=[n.join(","),...a.map(e=>n.map(t=>JSON.stringify(e[t]||"")).join(","))].join("\n"),s=new Blob([r],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a");i.href=URL.createObjectURL(s),i.download="audit_logs_".concat(t,".csv"),document.body.appendChild(i),i.click(),document.body.removeChild(i),await m().fire({title:"Export Complete!",text:"Successfully exported ".concat(b.length," records"),icon:"success",confirmButtonColor:"#13CE66"})}catch(e){console.error("Export failed:",e),await m().fire({title:"Export Failed",text:"An error occurred while exporting the audit logs",icon:"error",confirmButtonColor:"#FF4949"})}};return a?(0,n.jsx)("div",{className:"loading",children:"Loading audit logs..."}):(0,n.jsxs)("div",{className:"auditPage",children:[(0,n.jsxs)("div",{className:"settings",children:[(0,n.jsx)("input",{type:"text",placeholder:"Search logs...",value:o,onChange:e=>i(e.target.value),className:"searchInput"}),(0,n.jsxs)("div",{className:"filters",children:[(0,n.jsx)("input",{type:"date",value:u,onChange:e=>h(e.target.value),className:"dateInput"}),(0,n.jsx)("input",{type:"date",value:p,onChange:e=>g(e.target.value),className:"dateInput"}),(0,n.jsxs)("select",{value:l,onChange:e=>c(e.target.value),className:"tableFilter",children:[(0,n.jsx)("option",{value:"",children:"All Tables"}),(0,n.jsx)("option",{value:"ExpenseRecord",children:"Expense Records"}),(0,n.jsx)("option",{value:"RevenueRecord",children:"Revenue Records"}),(0,n.jsx)("option",{value:"Receipt",children:"Receipts"})]}),(0,n.jsx)("button",{onClick:S,className:"exportButton",children:"Export Logs"})]})]}),(0,n.jsxs)("div",{className:"tableContainer",children:[(0,n.jsxs)("table",{children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"Date & Time"}),(0,n.jsx)("th",{children:"Action"}),(0,n.jsx)("th",{children:"Table"}),(0,n.jsx)("th",{children:"Record ID"}),(0,n.jsx)("th",{children:"Performed By"}),(0,n.jsx)("th",{children:"IP Address"}),(0,n.jsx)("th",{children:"View Details"})]})}),(0,n.jsx)("tbody",{children:C.map(e=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:J(e.timestamp)}),(0,n.jsx)("td",{children:e.action}),(0,n.jsx)("td",{children:e.table_affected}),(0,n.jsx)("td",{children:e.record_id}),(0,n.jsx)("td",{children:e.performed_by}),(0,n.jsx)("td",{children:e.ip_address||"N/A"}),(0,n.jsx)("td",{children:(0,n.jsx)("button",{onClick:()=>y(e),className:"viewButton",children:"View"})})]},e.log_id))})]}),0===C.length&&(0,n.jsx)("p",{className:"noRecords",children:"No audit logs found."})]}),(0,n.jsx)(d,{currentPage:x,totalPages:w,pageSize:v,onPageChange:j,onPageSizeChange:_}),f&&(0,n.jsx)(G,{log:f,onClose:()=>y(null)})]})};a(4797);let H=()=>{let[e,t]=(0,r.useState)([{id:1,date:"2025-05-01",request:"Purchase Office Supplies",department:"Operations",amount:1500,status:1,priority:3},{id:2,date:"2024-05-03",request:"Purchase Fuel",department:"Operations",amount:6e3,status:2,priority:2},{id:3,date:"2024-02-01",request:"Purchase decorations",department:"Inventory",amount:500,status:3,priority:1}]),[a,s]=(0,r.useState)(""),[o,i]=(0,r.useState)(""),[l,c]=(0,r.useState)(""),[u,h]=(0,r.useState)(""),[p,g]=(0,r.useState)(1),[x,j]=(0,r.useState)(5),v=e.filter(e=>{let t=e.request.toLowerCase().includes(a.toLowerCase()),n=!o||e.department===o,r=(!l||e.date>=l)&&(!u||e.date<=u);return t&&n&&r}),_=p*x,f=v.slice(_-x,_),y=Math.ceil(v.length/x),b=async e=>{(await m().fire({title:"Are you sure?",text:"This will delete the record permanently.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#13CE66",cancelButtonColor:"#961C1E",confirmButtonText:"Yes, delete it!",backdrop:!1,cancelButtonText:"Cancel",background:"white"})).isConfirmed&&(t(t=>t.filter(t=>t.id!==e)),await m().fire({icon:"success",title:"Deleted!",text:"The record has been deleted.",confirmButtonColor:"#961C1E",background:"white",backdrop:!1}))};return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"financialRequestPage",children:[(0,n.jsxs)("div",{className:"settings",children:[(0,n.jsx)("input",{type:"text",placeholder:"Search Name",value:a,onChange:e=>s(e.target.value)}),(0,n.jsxs)("div",{className:"filters",children:[(0,n.jsx)("input",{type:"date",value:l,onChange:e=>c(e.target.value)}),(0,n.jsx)("input",{type:"date",value:u,onChange:e=>h(e.target.value)}),(0,n.jsxs)("select",{value:o,id:"categoryFilter",onChange:e=>i(e.target.value),children:[(0,n.jsx)("option",{value:"",children:"All Department"}),(0,n.jsx)("option",{value:"Marketing",children:"Inventory"}),(0,n.jsx)("option",{value:"Operations",children:"Operations"}),(0,n.jsx)("option",{value:"HR",children:"HR"})]})]})]}),(0,n.jsxs)("div",{className:"tableContainer",children:[(0,n.jsxs)("table",{children:[(0,n.jsx)("thead",{children:(0,n.jsx)("tr",{children:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("th",{children:"Date"}),(0,n.jsx)("th",{children:"Request"}),(0,n.jsx)("th",{children:"Department"}),(0,n.jsx)("th",{children:"Amount"}),(0,n.jsx)("th",{children:"Status"}),(0,n.jsx)("th",{children:"Priority"}),(0,n.jsx)("th",{children:"Actions"})]})})}),(0,n.jsx)("tbody",{children:f.map(e=>(0,n.jsx)("tr",{children:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("td",{children:e.date}),(0,n.jsx)("td",{children:e.request}),(0,n.jsx)("td",{children:e.department}),(0,n.jsxs)("td",{children:["â‚±",e.amount.toFixed(2)]}),(0,n.jsx)("td",{children:1===e.status?"approved":2===e.status?"pending":3===e.status?"rejected":"unknown"}),(0,n.jsx)("td",{children:1===e.priority?"low":2===e.priority?"medium":3===e.priority?"high":"unknown"}),(0,n.jsx)("td",{children:(0,n.jsx)("button",{onClick:()=>b(e.id),className:"deleteBtn",children:"Delete"})})]})},e.id))})]}),0===f.length&&(0,n.jsx)("p",{children:"No records found."})]}),(0,n.jsx)(d,{currentPage:p,totalPages:y,pageSize:x,onPageChange:g,onPageSizeChange:j})]})})},Y=()=>{let[e,t]=(0,r.useState)("Dashboard"),[a,s]=(0,r.useState)("");return(0,n.jsxs)("div",{className:"mainContainer",children:[(0,n.jsx)("div",{className:"navBarContainer",children:(0,n.jsx)(l,{activeModule:e,activeSubModule:a,setActiveModule:t,setActiveSubModule:s})}),(0,n.jsxs)("div",{className:"mainContent",children:[(0,n.jsx)("div",{className:"topBarContainer",children:(0,n.jsx)(c,{})}),(0,n.jsx)("div",{className:"pageContainer",children:(0,n.jsx)("div",{className:"contentContainer",children:(()=>{switch(e){case"Dashboard":return(0,n.jsx)(V,{});case"Revenue Management":return(0,n.jsx)(R,{});case"Expense Management":return(0,n.jsx)(B,{});case"Financial Requests":return(0,n.jsx)(H,{});case"Audit Logs":return(0,n.jsx)(z,{});default:return(0,n.jsx)("div",{children:"Module not found"})}})()})})]})]})}},3895:e=>{e.exports={modalOverlay:"ExportConfirmationModal_modalOverlay__Km72E",modalContent:"ExportConfirmationModal_modalContent__XNaue",summarySection:"ExportConfirmationModal_summarySection__3oPWE",dateRange:"ExportConfirmationModal_dateRange__lZ_Xx",financialSummary:"ExportConfirmationModal_financialSummary__gEE4w",summaryItem:"ExportConfirmationModal_summaryItem__d5nWj",categoryBreakdown:"ExportConfirmationModal_categoryBreakdown__MRhvd",categorySection:"ExportConfirmationModal_categorySection__iVF5Y",categoryItem:"ExportConfirmationModal_categoryItem__WJArg",modalActions:"ExportConfirmationModal_modalActions__SlgS3",cancelButton:"ExportConfirmationModal_cancelButton__ux5Wo",confirmButton:"ExportConfirmationModal_confirmButton__L06nL"}},4119:()=>{},4423:()=>{},4797:()=>{},6145:()=>{},6475:()=>{},6770:()=>{},7230:()=>{},7311:()=>{},8570:()=>{},9838:()=>{},9991:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[273,647,320,270,441,684,358],()=>t(1874)),_N_E=e.O()}]);