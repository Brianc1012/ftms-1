(()=>{var e={};e.id=419,e.ids=[419],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44831:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>w,routeModule:()=>d,serverHooks:()=>v,workAsyncStorage:()=>l,workUnitAsyncStorage:()=>m});var a={};r.r(a),r.d(a,{POST:()=>p});var n=r(96559),s=r(48088),i=r(37719),o=r(32190),u=r(79464),c=r(78388);async function p(e){try{let{action:t,table_affected:r,record_id:a,performed_by:n,details:s}=await e.json(),i=await u.z.auditLog.create({data:{log_id:await (0,c.$)("LOG"),action:t,table_affected:r,record_id:a,performed_by:n,details:s,timestamp:new Date,ip_address:e.headers.get("x-forwarded-for")||"unknown"}});return o.NextResponse.json(i)}catch(t){console.error("Failed to create audit log:",t);let e=t instanceof Error?t.message:"An unknown error occurred";return o.NextResponse.json({error:"Internal Server Error",details:e},{status:500})}}let d=new n.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/audit/route",pathname:"/api/audit",filename:"route",bundlePath:"app/api/audit/route"},resolvedPagePath:"C:\\Users\\Brian Caube\\OneDrive\\Documents\\capstone\\FTMS\\FTMS_JOEL\\ftms\\app\\api\\audit\\route.ts",nextConfigOutput:"",userland:a}),{workAsyncStorage:l,workUnitAsyncStorage:m,serverHooks:v}=d;function w(){return(0,i.patchFetch)({workAsyncStorage:l,workUnitAsyncStorage:m})}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},78388:(e,t,r)=>{"use strict";r.d(t,{$:()=>s,B:()=>i});let a=new(r(96330)).PrismaClient,n={ASG:"AssignmentCache",LOG:"AuditLog",EXP:"ExpenseRecord",ITM:"Item",ITX:"ItemTransaction",RCP:"Receipt",RCI:"ReceiptItem",REV:"RevenueRecord"};async function s(e){if(!n[e])throw Error(`Invalid table prefix: ${e}`);return await a.$transaction(async t=>{let r=await t.sequence.upsert({where:{name:e},update:{value:{increment:1}},create:{name:e,value:1}});return`FTMS-${e}-${String(r.value).padStart(8,"0")}`})}async function i(){let e=new Date().toISOString().slice(0,10).replace(/-/g,"");return await a.$transaction(async t=>{let r=`XPT-${e}`,a=await t.sequence.upsert({where:{name:r},update:{value:{increment:1}},create:{name:r,value:1}});return`FTMS-XPT-${e}-${String(a.value).padStart(4,"0")}`})}},79464:(e,t,r)=>{"use strict";r.d(t,{z:()=>n});var a=r(96330);let n=globalThis.prisma??new a.PrismaClient},96330:e=>{"use strict";e.exports=require("@prisma/client")},96487:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[447,580],()=>r(44831));module.exports=a})();