(()=>{var e={};e.id=841,e.ids=[841],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},13365:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var a=r(79464),i=r(78388),n=r(44999);async function s(e){try{if(e){let t=e.headers.get("x-forwarded-for");if(t)return t.split(",")[0].trim();let r=e.headers.get("x-real-ip");if(r)return r}try{let e=await (0,n.b3)(),t=e.get("x-forwarded-for");if(t)return t.split(",")[0].trim();let r=e.get("x-real-ip");if(r)return r}catch{}return"unknown"}catch(e){return console.error("Error getting client IP:",e),"unknown"}}async function c({action:e,table_affected:t,record_id:r,performed_by:n,details:c,ip_address:u,request:o}){try{let d=u||await s(o);await a.z.auditLog.create({data:{log_id:await (0,i.$)("LOG"),action:e,table_affected:t,record_id:r,performed_by:n,details:c,ip_address:d}})}catch(e){console.error("Failed to write audit log:",e)}}},17945:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>x,routeModule:()=>m,serverHooks:()=>_,workAsyncStorage:()=>w,workUnitAsyncStorage:()=>f});var a={};r.r(a),r.d(a,{GET:()=>l,POST:()=>p});var i=r(96559),n=r(48088),s=r(37719),c=r(32190),u=r(79464),o=r(13365),d=r(78388);async function p(e){try{let{supplier:t,transaction_date:r,vat_reg_tin:a,terms:i,status:n,total_amount:s,vat_amount:p,total_amount_due:l,created_by:m,items:w}=await e.json(),f=await u.z.receipt.create({data:{receipt_id:await (0,d.$)("RCP"),supplier:t,transaction_date:new Date(r),vat_reg_tin:a,terms:i,status:n,total_amount:s,vat_amount:p,total_amount_due:l,created_by:m,items:{create:w.map(e=>({receipt_item_id:(0,d.$)("RCI"),item_name:e.name,unit:e.unit,quantity:e.quantity,unit_price:e.unitPrice,total_price:e.quantity*e.unitPrice,created_by:m}))}},include:{items:!0}});for(let e of w){let t=await u.z.item.upsert({where:{item_name:e.name},create:{item_id:await (0,d.$)("ITM"),item_name:e.name,unit:e.unit,created_at:new Date},update:{updated_at:new Date}});await u.z.itemTransaction.create({data:{transaction_id:await (0,d.$)("ITX"),item_id:t.item_id,receipt_id:f.receipt_id,quantity:e.quantity,unit_price:e.unitPrice,created_by:m,transaction_date:new Date(r)}})}return await (0,o.A)({action:"CREATE",table_affected:"Receipt",record_id:f.receipt_id,performed_by:m,details:`Created receipt with ${w.length} items, total amount: ${s}`}),c.NextResponse.json(f)}catch(e){return console.error("Failed to create receipt:",e),c.NextResponse.json({error:"Failed to create receipt"},{status:500})}}async function l(){let e=await u.z.receipt.findMany({where:{is_deleted:!1},include:{items:!0},orderBy:{created_at:"desc"}});return c.NextResponse.json(e)}let m=new i.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/receipts/route",pathname:"/api/receipts",filename:"route",bundlePath:"app/api/receipts/route"},resolvedPagePath:"C:\\Users\\Brian Caube\\OneDrive\\Documents\\capstone\\FTMS\\FTMS_JOEL\\ftms\\app\\api\\receipts\\route.ts",nextConfigOutput:"",userland:a}),{workAsyncStorage:w,workUnitAsyncStorage:f,serverHooks:_}=m;function x(){return(0,s.patchFetch)({workAsyncStorage:w,workUnitAsyncStorage:f})}},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},78388:(e,t,r)=>{"use strict";r.d(t,{$:()=>n,B:()=>s});let a=new(r(96330)).PrismaClient,i={ASG:"AssignmentCache",LOG:"AuditLog",EXP:"ExpenseRecord",ITM:"Item",ITX:"ItemTransaction",RCP:"Receipt",RCI:"ReceiptItem",REV:"RevenueRecord"};async function n(e){if(!i[e])throw Error(`Invalid table prefix: ${e}`);return await a.$transaction(async t=>{let r=await t.sequence.upsert({where:{name:e},update:{value:{increment:1}},create:{name:e,value:1}});return`FTMS-${e}-${String(r.value).padStart(8,"0")}`})}async function s(){let e=new Date().toISOString().slice(0,10).replace(/-/g,"");return await a.$transaction(async t=>{let r=`XPT-${e}`,a=await t.sequence.upsert({where:{name:r},update:{value:{increment:1}},create:{name:r,value:1}});return`FTMS-XPT-${e}-${String(a.value).padStart(4,"0")}`})}},79464:(e,t,r)=>{"use strict";r.d(t,{z:()=>i});var a=r(96330);let i=globalThis.prisma??new a.PrismaClient},96330:e=>{"use strict";e.exports=require("@prisma/client")},96487:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[447,580,999],()=>r(17945));module.exports=a})();