(()=>{var e={};e.id=590,e.ids=[590],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11997:e=>{"use strict";e.exports=require("punycode")},27910:e=>{"use strict";e.exports=require("stream")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34631:e=>{"use strict";e.exports=require("tls")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},63874:(e,r,t)=>{"use strict";t.d(r,{N:()=>s});let s=(0,t(86345).UU)("https://dyvxlzuhnamrnqppehnv.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR5dnhsenVobmFtcm5xcHBlaG52Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgyNDM4ODUsImV4cCI6MjA2MzgxOTg4NX0.CKQLXvc4UUf55PHOj8FQuH-JeqVVpv1i4cwjKTVYxeE")},74075:e=>{"use strict";e.exports=require("zlib")},74763:(e,r,t)=>{"use strict";t.d(r,{ZA:()=>c,cc:()=>a,gr:()=>u});var s=t(63874);let n="http://localhost:3000";async function i(){try{let e=await fetch(`${n}/api/assignments/cache`);if(!e.ok)return null;let{data:r}=await e.json();if(!r)return null;return r.map(e=>({assignment_id:e.assignment_id,bus_bodynumber:e.bus_bodynumber,bus_platenumber:e.bus_platenumber,bus_route:e.bus_route,bus_type:e.bus_type,driver_name:e.driver_name,conductor_name:e.conductor_name,date_assigned:new Date(e.date_assigned).toISOString(),trip_fuel_expense:Number(e.trip_fuel_expense),trip_revenue:Number(e.trip_revenue),is_revenue_recorded:e.is_revenue_recorded,is_expense_recorded:e.is_expense_recorded,assignment_type:e.assignment_type}))}catch(e){return console.error("Error fetching from cache:",e),null}}async function o(){try{if(!(await fetch(`${n}/api/assignments/cache`,{method:"POST"})).ok)throw Error("Failed to update cache")}catch(e){throw console.error("Error updating cache:",e),e}}async function a(e){try{let r=await i();if(r){let t=r.find(r=>r.assignment_id===e);if(t)return t}let{data:t,error:n}=await s.N.from("op_bus_assignments").select("*").eq("assignment_id",e).single();if(n)return console.error("Failed to fetch assignment from Supabase:",n),null;return await o(),t?{...t,trip_fuel_expense:Number(t.trip_fuel_expense),trip_revenue:Number(t.trip_revenue)}:null}catch(e){return console.error("Error in getAssignmentById:",e),null}}async function u(){try{let e=await i();if(e)return e;let{data:r,error:t}=await s.N.from("op_bus_assignments").select("*");if(t)throw Error(t.message);return await o(),r.map(e=>({...e,trip_fuel_expense:Number(e.trip_fuel_expense),trip_revenue:Number(e.trip_revenue),is_expense_recorded:!!e.is_expense_recorded,is_revenue_recorded:!!e.is_revenue_recorded}))}catch(e){throw console.error("Error fetching all assignments:",e),e}}async function c(e,r){try{let{data:t,error:n}=await s.N.from("op_bus_assignments").update({is_revenue_recorded:r}).eq("assignment_id",e).select();if(n)throw Error(`Failed to update is_revenue_recorded: ${n.message}`);return await o(),t}catch(e){throw console.error("Error updating assignment:",e),e}}},76323:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>f,routeModule:()=>d,serverHooks:()=>_,workAsyncStorage:()=>l,workUnitAsyncStorage:()=>m});var s={};t.r(s),t.d(s,{GET:()=>c,PUT:()=>p});var n=t(96559),i=t(48088),o=t(37719),a=t(32190),u=t(74763);async function c(e){let r=e.nextUrl.pathname.split("/").pop();if(!r)return a.NextResponse.json({error:"Assignment ID is required"},{status:400});try{let e=await (0,u.cc)(r);if(!e)return a.NextResponse.json({error:"Assignment not found"},{status:404});return a.NextResponse.json(e)}catch(r){console.error("Failed to fetch assignment from Supabase:",r);let e=r instanceof Error?r.message:"Internal Server Error";return a.NextResponse.json({error:e},{status:500})}}async function p(e){let r=e.nextUrl.pathname.split("/").pop();if(!r)return a.NextResponse.json({error:"Assignment ID is required"},{status:400});try{let{is_revenue_recorded:t}=await e.json();if("boolean"!=typeof t)return a.NextResponse.json({error:"Invalid value for is_revenue_recorded"},{status:400});let s=await (0,u.ZA)(r,t);return a.NextResponse.json({success:!0,updated:s})}catch(r){console.error("Failed to update assignment is_revenue_recorded:",r);let e=r instanceof Error?r.message:"Internal Server Error";return a.NextResponse.json({error:e},{status:500})}}let d=new n.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/assignments/[id]/route",pathname:"/api/assignments/[id]",filename:"route",bundlePath:"app/api/assignments/[id]/route"},resolvedPagePath:"C:\\Users\\Brian Caube\\OneDrive\\Documents\\capstone\\FTMS\\FTMS_JOEL\\ftms\\app\\api\\assignments\\[id]\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:l,workUnitAsyncStorage:m,serverHooks:_}=d;function f(){return(0,o.patchFetch)({workAsyncStorage:l,workUnitAsyncStorage:m})}},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},81630:e=>{"use strict";e.exports=require("http")},91645:e=>{"use strict";e.exports=require("net")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[447,580,345],()=>t(76323));module.exports=s})();